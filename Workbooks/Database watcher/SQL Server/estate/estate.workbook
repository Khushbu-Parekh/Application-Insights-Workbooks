{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "19f22da1-c8c7-42cc-9849-cf6aeddb7ba0",
            "version": "KqlParameterItem/1.0",
            "name": "linkAdxClusterUri",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "value": ""
          },
          {
            "id": "b4b8f00b-7e05-4ae2-ad2b-2ba99f74b49a",
            "version": "KqlParameterItem/1.0",
            "name": "linkAdxDatabase",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "value": ""
          }
        ],
        "style": "pills",
        "queryType": 9
      },
      "conditionalVisibility": {
        "parameterName": "neverShow",
        "comparison": "isNotEqualTo"
      },
      "name": "link_adx_parameters"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Data store",
        "expandable": true,
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a762a2ae-beec-4bf5-9f4a-28bea2d2f737",
                  "version": "KqlParameterItem/1.0",
                  "name": "watcherResourceId",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "value": ""
                },
                {
                  "id": "83420d36-0646-40aa-9637-d06a3d2a6145",
                  "version": "KqlParameterItem/1.0",
                  "name": "watcherResource",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{watcherResourceId}?api-version=2023-03-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":null}",
                  "isHiddenWhenLocked": true,
                  "queryType": 12
                },
                {
                  "id": "a6cd9521-127a-43bd-9227-6bcd67756456",
                  "version": "KqlParameterItem/1.0",
                  "name": "watcherName",
                  "type": 1,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"{watcherResource}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.name\",\"columns\":[]}}]}",
                  "isHiddenWhenLocked": true,
                  "queryType": 8
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "watcherAdxClusterUri",
                  "type": 1,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"{watcherResource}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties.datastore.adxClusterUri\",\"columns\":[]}}]}",
                  "isHiddenWhenLocked": true,
                  "queryType": 8,
                  "id": "f0889b5f-3fa4-40a0-838d-443b4c0472b6"
                },
                {
                  "id": "0797c608-2ecf-4711-ba9b-6d110f10acd3",
                  "version": "KqlParameterItem/1.0",
                  "name": "watcherAdxDatabase",
                  "type": 1,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"{watcherResource}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"\",\"columns\":[{\"path\":\"$.properties.datastore.adxDatabaseResourceId\",\"columnid\":\"value\",\"columnType\":\"string\",\"substringRegexMatch\":\".*/(.*)\",\"substringReplace\":\"$1\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "queryType": 8
                },
                {
                  "id": "1b7d18f3-88a9-40ed-9162-92710b29ba69",
                  "version": "KqlParameterItem/1.0",
                  "name": "dataStore",
                  "label": "Choose a data store",
                  "type": 10,
                  "description": "By default, the workbook loads data from the data store for the current database watcher. You may use an alternate data store by entering its Kusto query URI and database name.",
                  "isRequired": true,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"[{\\\"value\\\":\\\"watcher\\\",\\\"label\\\":\\\"{watcherName}\\\"},{\\\"value\\\":\\\"alternate\\\",\\\"label\\\":\\\"Alternate\\\"}]\",\"transformers\":null}",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 8,
                  "value": "watcher"
                }
              ],
              "style": "above",
              "queryType": 12
            },
            "customWidth": "30",
            "name": "watcher_adx_parameters"
          },
          {
            "type": 1,
            "content": {
              "json": "Kusto query URI: `{watcherAdxClusterUri}` </p>\r\nKusto database: `{watcherAdxDatabase}`"
            },
            "customWidth": "70",
            "conditionalVisibilities": [
              {
                "parameterName": "watcherName",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "watcherAdxClusterUri",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "watcherAdxDatabase",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "dataStore",
                "comparison": "isEqualTo",
                "value": "watcher"
              }
            ],
            "name": "watcher_data_store"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "bbce4b83-dae6-46e0-bf67-c99ee0ea21f0",
                  "version": "KqlParameterItem/1.0",
                  "name": "overrideAdxClusterUri",
                  "label": "Kusto query URI",
                  "type": 1,
                  "description": "Enter a Kusto query URI for the alternate data store. Most commonly, Kusto query URI format is: https://{kusto-cluster-name}.{region}.kusto.windows.net/",
                  "isRequired": true,
                  "value": ""
                },
                {
                  "id": "99cdb447-94d3-40c7-b902-c98628fb736a",
                  "version": "KqlParameterItem/1.0",
                  "name": "overrideAdxDatabase",
                  "label": "Kusto database",
                  "type": 1,
                  "description": "Enter a Kusto database name for the alternate data store",
                  "isRequired": true
                }
              ],
              "style": "formHorizontal",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "dataStore",
              "comparison": "isEqualTo",
              "value": "alternate"
            },
            "name": "override_adx_parameters"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "19f22da1-c8c7-42cc-9849-cf6aeddb7ba0",
                  "version": "KqlParameterItem/1.0",
                  "name": "adxClusterUri",
                  "type": 1,
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "dataStore",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "alternate",
                        "resultValType": "param",
                        "resultVal": "overrideAdxClusterUri"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "linkAdxClusterUri",
                        "operator": "isNotNull",
                        "rightValType": "param",
                        "resultValType": "param",
                        "resultVal": "linkAdxClusterUri"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "dataStore",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "watcher",
                        "resultValType": "param",
                        "resultVal": "watcherAdxClusterUri"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "param",
                        "resultVal": "linkAdxClusterUri"
                      }
                    }
                  ]
                },
                {
                  "id": "b4b8f00b-7e05-4ae2-ad2b-2ba99f74b49a",
                  "version": "KqlParameterItem/1.0",
                  "name": "adxDatabase",
                  "type": 1,
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "dataStore",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "alternate",
                        "resultValType": "param",
                        "resultVal": "overrideAdxDatabase"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "linkAdxDatabase",
                        "operator": "isNotNull",
                        "rightValType": "param",
                        "resultValType": "param",
                        "resultVal": "linkAdxDatabase"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "dataStore",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "watcher",
                        "resultValType": "param",
                        "resultVal": "watcherAdxDatabase"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "param",
                        "resultVal": "linkAdxDatabase"
                      }
                    }
                  ]
                },
                {
                  "id": "c5aca9de-de62-466e-bea8-9a149e935c4f",
                  "version": "KqlParameterItem/1.0",
                  "name": "adxClusterPingResult",
                  "label": "Kusto query URI ping result",
                  "type": 1,
                  "isRequired": true,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show databases\\r\\n| where DatabaseName == @\\\"{adxDatabase}\\\"\\r\\n| project 1\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"\"}",
                  "isHiddenWhenLocked": true,
                  "queryType": 9
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "adx_parameters"
          },
          {
            "type": 1,
            "content": {
              "json": "Cannot connect to Kusto query URI `{adxClusterUri}`, database `{adxDatabase}`. The Kusto cluster may be stopped or unreachable, specified cluster URI may be invalid, or permissions may be insufficient.",
              "style": "warning"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "adxClusterPingResult",
                "comparison": "isNotEqualTo",
                "value": "1"
              },
              {
                "parameterName": "adxClusterUri",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "adxDatabase",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "missing_data_bad_permissions_text"
          }
        ],
        "exportParameters": true
      },
      "name": "data_store_group"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "38d18c5b-3cca-4bae-85b7-c74821db1d12",
            "version": "KqlParameterItem/1.0",
            "name": "count_sqlserver_tables",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName startswith \\\"sqlserver_\\\"\\r\\n| summarize cnt = tostring(count())\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_properties",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_properties\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9,
            "id": "86d12280-d36f-403e-a4f3-3d8676735890"
          },
          {
            "id": "164fc8bc-15fa-44b2-8bc9-62d640bafe32",
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_cpu_utilization",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_cpu_utilization\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          },
          {
            "id": "6bb1d339-6528-43fe-83d4-30c0fc035083",
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_performance_counters_common",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_performance_counters_common\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          },
          {
            "id": "b62888c4-ef36-4588-8410-08403ec8dd40",
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_volume_storage_utilization",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_volume_storage_utilization\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9
          },
          {
            "id": "0fd8f0d6-3074-46a8-ba1f-6aa5b9329ad1",
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_database_properties",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_database_properties\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_database_replicas",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_database_replicas\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9,
            "id": "045ed2da-4b5a-45e1-bd74-224df68d0a6b"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_wait_stats",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_wait_stats\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9,
            "id": "1b995924-1bcd-4dd3-814e-0ec7823439c3"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_connectivity",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_connectivity\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9,
            "id": "6572b327-7490-41ea-b18c-b482d61ed7a4"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_query_runtime_stats",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_query_runtime_stats\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9,
            "id": "3fabebca-5a27-466b-b977-8f29fb6d4933"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "sqlserver_query_wait_stats",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\".show tables\\r\\n| where TableName == \\\"sqlserver_query_wait_stats\\\"\\r\\n| project true\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9,
            "id": "377394db-6a2c-41c1-b2a1-df53141a1da3"
          }
        ],
        "style": "above",
        "queryType": 9
      },
      "conditionalVisibility": {
        "parameterName": "alwaysHidden",
        "comparison": "isNotEqualTo"
      },
      "name": "table_presence_parameters"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "290bc25c-7ae2-414b-8e4b-2a06325fe590",
            "version": "KqlParameterItem/1.0",
            "name": "timeRange",
            "label": "Time range",
            "type": 4,
            "isRequired": true,
            "isGlobal": true,
            "value": {
              "durationMs": 3600000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "ca4863e4-64e2-42fc-bf8a-7a158256911b",
            "version": "KqlParameterItem/1.0",
            "name": "machineNameFilterValue",
            "label": "Machine",
            "type": 1,
            "description": "Enter a value to filter by full or partial machine name",
            "typeSettings": {
              "paramValidationRules": [
                {
                  "regExp": "\\\"",
                  "match": false,
                  "message": "Machine name filter value may not contain double quotes"
                }
              ]
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": ""
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "serverNameFilterValue",
            "label": "SQL instance",
            "type": 1,
            "description": "Enter a value to filter by full or partial server name",
            "typeSettings": {
              "paramValidationRules": [
                {
                  "regExp": "\\\"",
                  "match": false,
                  "message": "Server name filter value may not contain double quotes"
                }
              ]
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "26ec743a-48d3-4e5b-b5e4-7ce839f08001",
            "value": ""
          },
          {
            "id": "9353f345-7d22-419c-b9cf-a39647fff8fd",
            "version": "KqlParameterItem/1.0",
            "name": "matchPattern",
            "label": "Match pattern",
            "type": 2,
            "description": "Select a string match operator to filter by server and machine name",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\":\"startswith\",\"label\":\"starts with\"},\r\n    {\"value\":\"contains\",\"label\":\"contains\"},\r\n    {\"value\":\"endswith\",\"label\":\"ends with\"},\r\n    {\"value\":\"!startswith\",\"label\":\"does not start with\"},\r\n    {\"value\":\"!contains\",\"label\":\"does not contain\"},\r\n    {\"value\":\"!endswith\",\"label\":\"does not end with\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "contains"
          },
          {
            "id": "7fc24d10-032f-4d35-950c-ca95e354c95a",
            "version": "KqlParameterItem/1.0",
            "name": "machineNameFilter",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "machineNameFilterValue",
                  "operator": "is Empty",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "// no machine_name filter"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "startswith",
                  "resultValType": "static",
                  "resultVal": "| where machine_name startswith @\"{machineNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "contains",
                  "resultValType": "static",
                  "resultVal": "| where machine_name contains @\"{machineNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "endswith",
                  "resultValType": "static",
                  "resultVal": "| where machine_name endswith @\"{machineNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "!startswith",
                  "resultValType": "static",
                  "resultVal": "| where machine_name !startswith @\"{machineNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "!contains",
                  "resultValType": "static",
                  "resultVal": "| where machine_name !contains @\"{machineNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "!endswith",
                  "resultValType": "static",
                  "resultVal": "| where machine_name !endswith @\"{machineNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "// no machine_name filter"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "81438e4f-dee3-435a-8687-ac6853a24d87",
            "version": "KqlParameterItem/1.0",
            "name": "serverNameFilter",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "serverNameFilterValue",
                  "operator": "is Empty",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "// no server_name filter"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "startswith",
                  "resultValType": "static",
                  "resultVal": "| where server_name startswith @\"{serverNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "contains",
                  "resultValType": "static",
                  "resultVal": "| where server_name contains @\"{serverNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "endswith",
                  "resultValType": "static",
                  "resultVal": "| where server_name endswith @\"{serverNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "!startswith",
                  "resultValType": "static",
                  "resultVal": "| where server_name !startswith @\"{serverNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "!contains",
                  "resultValType": "static",
                  "resultVal": "| where server_name !contains @\"{serverNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "matchPattern",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "!endswith",
                  "resultValType": "static",
                  "resultVal": "| where server_name !endswith @\"{serverNameFilterValue}\""
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "// no server_name filter"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "af2747c0-e919-4558-ac14-bbb8130320a1",
            "version": "KqlParameterItem/1.0",
            "name": "showDescriptions",
            "label": "Show descriptions",
            "type": 10,
            "description": "Shows descriptions next to charts",
            "isRequired": true,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\":\"true\",\"label\":\"Yes\"},{\"value\":\"false\",\"label\":\"No\"}]",
            "value": "false"
          },
          {
            "id": "0183848b-e820-4d26-8264-5eaf9e65e6b9",
            "version": "KqlParameterItem/1.0",
            "name": "grainFactor",
            "label": "Grain factor",
            "type": 2,
            "description": "Higher time grain provides more details on charts when granular data exists.",
            "isRequired": true,
            "value": "4",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\":1,\"label\":1},{\"value\":2,\"label\":2},{\"value\":3,\"label\":3},{\"value\":4,\"label\":4},{\"value\":5,\"label\":5},{\"value\":6,\"label\":6}]"
          },
          {
            "id": "5308da78-e372-4f1a-a428-c0bedd9c2f3a",
            "version": "KqlParameterItem/1.0",
            "name": "tabName",
            "type": 1,
            "value": "Heatmaps",
            "isHiddenWhenLocked": true
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "adxClusterPingResult",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "count_sqlserver_tables",
          "comparison": "isNotEqualTo",
          "value": "0"
        }
      ],
      "name": "parameters"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let time_range = datatable(key:int, time_range_start:datetime, time_range_end:datetime) [\\r\\n1, datetime(\\\"{timeRange:startISO}\\\"), datetime(\\\"{timeRange:endISO}\\\")\\r\\n];\\r\\nlet target_count = toscalar(\\r\\nsqlserver_properties\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n| project sample_time_utc, unique_name = strcat(server_name, machine_name)\\r\\n| summarize total_targets = dcount(unique_name)\\r\\n);\\r\\ntime_range\\r\\n| project time_range_start, time_range_end, time_range_duration = datetime_diff('second', time_range_end, time_range_start), target_count, last_refresh_time = now(), ingestion_stats_link = \\\"Community-Workbooks/Database watcher/Ingestion stats\\\", adx_link = strcat(trim_end(\\\"/\\\", \\\"{adxClusterUri}\\\"), \\\"/\\\", \\\"{adxDatabase}\\\")\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "noDataMessage": "There is no data for specified parameters.",
              "queryType": 9,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "time_range_start",
                    "formatter": 6,
                    "formatOptions": {
                      "customColumnWidthSetting": "23ch"
                    },
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    },
                    "tooltipFormat": {
                      "tooltip": "Start of time range, as of last refresh"
                    }
                  },
                  {
                    "columnMatch": "time_range_end",
                    "formatter": 6,
                    "formatOptions": {
                      "customColumnWidthSetting": "23ch"
                    },
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    },
                    "tooltipFormat": {
                      "tooltip": "End of time range, as of last refresh"
                    }
                  },
                  {
                    "columnMatch": "time_range_duration",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "target_count",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Total monitored SQL Server instances in selected time range"
                    }
                  },
                  {
                    "columnMatch": "last_refresh_time",
                    "formatter": 6,
                    "formatOptions": {
                      "customColumnWidthSetting": "23ch"
                    },
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    },
                    "tooltipFormat": {
                      "tooltip": "Workbook refresh date and time"
                    }
                  },
                  {
                    "columnMatch": "ingestion_stats_link",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "WorkbookTemplate",
                      "linkLabel": "Ingestion statistics",
                      "linkIsContextBlade": true,
                      "workbookContext": {
                        "componentIdSource": "workbook",
                        "resourceIdsSource": "workbook",
                        "templateIdSource": "column",
                        "templateId": "ingestion_stats_link",
                        "typeSource": "workbook",
                        "gallerySource": "default",
                        "locationSource": "workbook",
                        "workbookName": "Data ingestion statistics",
                        "passSpecificParams": true,
                        "templateParameters": [
                          {
                            "name": "adxClusterUri",
                            "source": "parameter",
                            "value": "adxClusterUri"
                          },
                          {
                            "name": "adxDatabase",
                            "source": "parameter",
                            "value": "adxDatabase"
                          },
                          {
                            "name": "timeRange",
                            "source": "parameter",
                            "value": "timeRange"
                          },
                          {
                            "name": "targetType",
                            "source": "static",
                            "value": "sqlserver"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "View ingestion statistics including ingestion latency for each table"
                    }
                  },
                  {
                    "columnMatch": "adx_link",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Query ADX database",
                      "linkIsContextBlade": false
                    },
                    "tooltipFormat": {
                      "tooltip": "Explore monitoring data using ad-hoc KQL queries"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "time_range_start",
                    "label": "Time range start"
                  },
                  {
                    "columnId": "time_range_end",
                    "label": "Time range end"
                  },
                  {
                    "columnId": "time_range_duration",
                    "label": "Duration"
                  },
                  {
                    "columnId": "target_count",
                    "label": "Instances"
                  },
                  {
                    "columnId": "last_refresh_time",
                    "label": "Last refresh"
                  },
                  {
                    "columnId": "ingestion_stats_link",
                    "label": "Data ingestion"
                  },
                  {
                    "columnId": "adx_link",
                    "label": "Data store"
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "title",
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "The time from collection to ingestion for the last data sample in selected time range, and latency trend in that range."
                  }
                },
                "leftContent": {
                  "columnMatch": "title",
                  "formatter": 1
                },
                "rightContent": {
                  "columnMatch": "last_latency_timespan",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  },
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "latency_trend",
                  "formatter": 10,
                  "formatOptions": {
                    "palette": "turquoise",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": []
                    }
                  }
                },
                "showBorder": false,
                "sortOrderField": 1,
                "size": "auto"
              }
            },
            "name": "header_time_range"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibilities": [
        {
          "parameterName": "sqlserver_cpu_utilization",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "adxClusterPingResult",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "timeRange",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "sqlserver_properties",
          "comparison": "isEqualTo",
          "value": "1"
        }
      ],
      "name": "header_group"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "tabStyle": "bigger",
        "links": [
          {
            "id": "10e98cdf-277d-4010-ac79-cf8c5c92694d",
            "cellValue": "tabName",
            "linkTarget": "parameter",
            "linkLabel": "Heatmaps",
            "subTarget": "Heatmaps",
            "style": "link"
          },
          {
            "id": "9acdfd5b-d8b9-4708-b6b4-8605f0e1da6e",
            "cellValue": "tabName",
            "linkTarget": "parameter",
            "linkLabel": "Servers",
            "subTarget": "Servers",
            "style": "link"
          },
          {
            "id": "1501b2b0-1db6-450b-a296-9e511b957a3b",
            "cellValue": "tabName",
            "linkTarget": "parameter",
            "linkLabel": "Top queries",
            "subTarget": "Top queries",
            "style": "link"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "adxClusterPingResult",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "timeRange",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "count_sqlserver_tables",
          "comparison": "isNotEqualTo",
          "value": "0"
        }
      ],
      "name": "top_tabs"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "ea8899df-fb45-425b-905e-7aa7865b9d24",
            "version": "KqlParameterItem/1.0",
            "name": "HeatmapGroupBy",
            "label": "Group by",
            "type": 10,
            "description": "Display hexagons in groups. Select \"Machine name\" to see all SQL instances on the same machine together, or select \"Failover cluster name\" to see all SQL instances on the nodes of the same cluster together.",
            "isRequired": true,
            "value": "cluster",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\":\"none\",\"label\":\"None\"},{\"value\":\"machine\",\"label\":\"Machine name\"},{\"value\":\"cluster\",\"label\":\"Failover cluster name\"}]",
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "formHorizontal",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Heatmaps"
        },
        {
          "parameterName": "adxClusterPingResult",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "timeRange",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "count_sqlserver_tables",
          "comparison": "isNotEqualTo",
          "value": "0"
        }
      ],
      "name": "heatmap_grouping_parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "* On each heatmap, a hexagon represents a SQL Server instance\r\n* Heatmaps show top resource consuming instances. Use name filters or the `Servers` grid to find other instances.\r\n* Instances can be grouped by machine (aka computer, aka node) name, or by failover cluster name\r\n* Click on the SQL instance name in a hexagon to open a detailed dashboard for that instance\r\n* Hexagons colors are described below. Instances with insufficient data are colored gray.\r\n\r\n|Heatmap|Description|\r\n|:-|:-|\r\n|`CPU`|Each hexagon is colored depending on average CPU utilization in the selected time range, by band: green (0%-49%), yellow (50%-69%), orange (70%-89%), and red (90%-100%)|\r\n|`Requests`|Each hexagon is colored depending on the average rate of batch requests in the selected time range, with colder colors such as blue representing lower rates, and warmer colors such as red representing higher rates|\r\n|`Lock waits`|Each hexagon is colored depending on cumulative wait time of lock (`LCK_M_*`) waits in the selected time range, using the green-to-red color palette. Green represents minimal waits, red represents higher waits compared to other SQL instances on the same heatmap.|\r\n|`Availability group health`|Each hexagon is colored green if for every sample in selected time range, all availability databases and replicas were healthy. Otherwise, it is colored red, and the number of samples with unhealthy databases or replicas is shown at the bottom.|\r\n|`Connectivity`|Each hexagon is colored green if every connectivity probe for that SQL instance in selected time range was successful. Otherwise, it is colored red, and the number of failed connectivity probes is shown at the bottom.|"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Heatmaps"
        },
        {
          "parameterName": "showDescriptions",
          "comparison": "isEqualTo",
          "value": "true"
        },
        {
          "parameterName": "adxClusterPingResult",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "timeRange",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "heatmaps_help"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "1166beb9-0014-4358-9e65-e9098006cede",
            "cellValue": "heatmapTabName",
            "linkTarget": "parameter",
            "linkLabel": "CPU",
            "subTarget": "CPU",
            "style": "link"
          },
          {
            "id": "7ac69d9e-fa5e-449d-ab27-1c600c2bab4d",
            "cellValue": "heatmapTabName",
            "linkTarget": "parameter",
            "linkLabel": "Requests",
            "subTarget": "Requests",
            "style": "link"
          },
          {
            "id": "ca5f76ae-3b69-4fda-ae80-e9d975311d8f",
            "cellValue": "heatmapTabName",
            "linkTarget": "parameter",
            "linkLabel": "Lock waits",
            "subTarget": "Lock waits",
            "style": "link"
          },
          {
            "id": "f518c41a-0b05-4608-bf6f-9836e6f00147",
            "cellValue": "heatmapTabName",
            "linkTarget": "parameter",
            "linkLabel": "Availability group health",
            "subTarget": "Availability group health",
            "style": "link"
          },
          {
            "id": "78fdec9c-e550-4575-adae-948c83d0a7ba",
            "cellValue": "heatmapTabName",
            "linkTarget": "parameter",
            "linkLabel": "Connectivity",
            "subTarget": "Connectivity",
            "style": "link"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Heatmaps"
        },
        {
          "parameterName": "adxClusterPingResult",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "timeRange",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "count_sqlserver_tables",
          "comparison": "isNotEqualTo",
          "value": "0"
        }
      ],
      "name": "heatmap_tabs"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let cpu_utilization = materialize (\\r\\nsqlserver_cpu_utilization\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| project-away process_sample_time_utc, idle_cpu_percent\\r\\n| partition hint.strategy = shuffle by machine_name\\r\\n(\\r\\nsummarize cpu_percentage = avg(avg_cpu_percent), count_samples = dcount(sample_time_utc) by machine_name, server_name, binned_sample_time_utc = bin(sample_time_utc, {timeRange:grain})\\r\\n)\\r\\n);\\r\\n// total count of samples per machine, server in selected time range\\r\\nlet total_sample_count = (\\r\\ncpu_utilization\\r\\n| summarize total_count_samples = sum(count_samples) by machine_name, server_name\\r\\n);\\r\\n// typical count of samples per machine, server in selected time range\\r\\nlet expected_sample_count = toscalar(\\r\\ntotal_sample_count\\r\\n| summarize percentile(total_count_samples, 90)\\r\\n);\\r\\nlet cpu_timeline = (\\r\\ncpu_utilization\\r\\n| lookup total_sample_count on machine_name, server_name\\r\\n| make-series cpu_percentage_timeline = avg(cpu_percentage) default = long(null) on binned_sample_time_utc from {timeRange:start} to {timeRange:end} step {timeRange:grain} by machine_name, server_name\\r\\n);\\r\\nlet server_properties = (\\r\\nsqlserver_properties\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize arg_max(sample_time_utc, cluster_name) by machine_name, server_name\\r\\n);\\r\\nlet agg_cpu_utilization = (\\r\\ncpu_utilization\\r\\n| lookup total_sample_count on machine_name, server_name\\r\\n| summarize cpu_percentage = sum(cpu_percentage * toreal(count_samples) / toreal(total_count_samples)), // weighted average\\r\\n            count_samples = sum(count_samples)\\r\\n            by machine_name, server_name\\r\\n| join kind=leftouter cpu_timeline on machine_name, server_name\\r\\n| join kind=leftouter server_properties on machine_name, server_name\\r\\n| project machine_name, server_name, cluster_name, cpu_percentage = iif(toreal(count_samples)/expected_sample_count < 0.5, real(null), toreal(cpu_percentage)), cpu_percentage_timeline,\\r\\n          color = case(\\r\\n                      toreal(count_samples)/expected_sample_count < 0.5, \\\"gray\\\", // show color as grey (unknown) if the number of samples is much less than the representative number across all servers\\r\\n                      cpu_percentage >= 90, \\\"red\\\",\\r\\n                      cpu_percentage >= 70, \\\"orange\\\",\\r\\n                      cpu_percentage >= 50, \\\"yellow\\\",\\r\\n                      cpu_percentage >= 0, \\\"green\\\",\\r\\n                      \\\"\\\"\\r\\n                      ),\\r\\n          grouper = case(\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"machine\\\", machine_name,\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"cluster\\\", cluster_name,\\r\\n                        server_name\\r\\n                        )\\r\\n);\\r\\n// Get the max value across servers in each grouper. This is used to limit to top N servers without tearing groups (machines, clusters).\\r\\nlet agg_cpu_utilization_grouper = (\\r\\nagg_cpu_utilization\\r\\n| summarize cpu_percentage = max(cpu_percentage) by grouper\\r\\n| sort by cpu_percentage desc\\r\\n| project grouper, cpu_percentage, grouper_number = row_number()\\r\\n);\\r\\nagg_cpu_utilization\\r\\n| lookup agg_cpu_utilization_grouper on grouper\\r\\n| where grouper_number <= 50 // limit to top hitters\\r\\n| project machine_name, server_name, cluster_name, cpu_percentage, grouper_cpu_percentage = cpu_percentage1, color, cpu_percentage_timeline, grouper = iif(\\\"{HeatmapGroupBy}\\\" == \\\"none\\\", \\\"\\\", grouper)\\r\\n| sort by tolower(grouper) asc, tolower(machine_name) asc, tolower(server_name) asc\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "showAnalytics": true,
        "noDataMessage": "There is no data for specified parameters.",
        "showExportToExcel": true,
        "queryType": 9,
        "visualization": "graph",
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "server_name",
            "formatter": 1,
            "formatOptions": {
              "linkTarget": "WorkbookTemplate",
              "workbookContext": {
                "componentIdSource": "workbook",
                "resourceIdsSource": "workbook",
                "templateIdSource": "static",
                "templateId": "Community-Workbooks/Database watcher/SQL Server/instance",
                "typeSource": "workbook",
                "gallerySource": "default",
                "locationSource": "workbook",
                "workbookName": "SQL Server instance",
                "passSpecificParams": true,
                "templateParameters": [
                  {
                    "name": "machineName",
                    "source": "column",
                    "value": "machine_name"
                  },
                  {
                    "name": "serverName",
                    "source": "column",
                    "value": "server_name"
                  },
                  {
                    "name": "timeRange",
                    "source": "parameter",
                    "value": "timeRange"
                  },
                  {
                    "name": "linkAdxClusterUri",
                    "source": "parameter",
                    "value": "adxClusterUri"
                  },
                  {
                    "name": "linkAdxDatabase",
                    "source": "parameter",
                    "value": "adxDatabase"
                  },
                  {
                    "name": "tabName",
                    "source": "static",
                    "value": "Overview"
                  },
                  {
                    "name": "showDescriptions",
                    "source": "parameter",
                    "value": "showDescriptions"
                  }
                ]
              },
              "bladeOpenContext": {
                "bladeParameters": []
              }
            }
          },
          "centerContent": {
            "columnMatch": "cpu_percentage",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "numberFormat": {
              "unit": 1,
              "options": {
                "style": "decimal"
              },
              "emptyValCustomText": "N/A"
            },
            "tooltipFormat": {
              "tooltip": "Average CPU percentage for selected time range. Shows \"N/A\" if the number of samples is insufficient."
            }
          },
          "bottomContent": {
            "columnMatch": "cpu_percentage_timeline",
            "formatter": 21,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "purple"
            },
            "tooltipFormat": {
              "tooltip": "Average CPU utilization over selected time range"
            }
          },
          "hivesContent": {
            "columnMatch": "grouper",
            "formatter": 1
          },
          "nodeIdField": "server_name",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 150,
          "colorSettings": {
            "nodeColorField": "color",
            "type": 3,
            "thresholdsGrid": [
              {
                "operator": "==",
                "thresholdValue": "gray",
                "representation": "gray"
              },
              {
                "operator": "==",
                "thresholdValue": "red",
                "representation": "red"
              },
              {
                "operator": "==",
                "thresholdValue": "orange",
                "representation": "orange"
              },
              {
                "operator": "==",
                "thresholdValue": "yellow",
                "representation": "yellow"
              },
              {
                "operator": "==",
                "thresholdValue": "green",
                "representation": "green"
              },
              {
                "operator": "Default",
                "thresholdValue": null
              }
            ]
          },
          "groupByField": "grouper",
          "hivesMargin": 5
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "sqlserver_cpu_utilization",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "sqlserver_properties",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Heatmaps"
        },
        {
          "parameterName": "heatmapTabName",
          "comparison": "isEqualTo",
          "value": "CPU"
        }
      ],
      "name": "cpu_heatmap"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let requests = materialize (\\r\\nsqlserver_performance_counters_common\\r\\n| where sample_time_utc between (({timeRange:start} - {timeRange:grain}) .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| where object_name == \\\"SQL Statistics\\\" and counter_name in (\\\"Batch Requests/sec\\\")\\r\\n| project-away instance_name, database_id, database_name\\r\\n| partition hint.strategy = shuffle by machine_name\\r\\n(\\r\\nsort by server_name asc, sample_time_utc asc\\r\\n| extend delta_cntr_value = iif(cntr_value >= prev(cntr_value) and server_name == prev(server_name), cntr_value - prev(cntr_value), real(null)),\\r\\n         delta_sample_time_utc = iif(sample_time_utc >= prev(sample_time_utc), datetime_diff(\\\"Millisecond\\\", sample_time_utc, prev(sample_time_utc)), long(null))\\r\\n| where isnotempty(delta_sample_time_utc)\\r\\n| extend value = delta_cntr_value / delta_sample_time_utc * 1000\\r\\n| project-away cntr_type, cntr_value, delta_cntr_value, delta_sample_time_utc\\r\\n| summarize requests_rate = avg(value), count_samples = dcount(sample_time_utc) by machine_name, server_name, binned_sample_time_utc = bin(sample_time_utc, {timeRange:grain})\\r\\n)\\r\\n);\\r\\n// total count of samples per machine, server in selected time range\\r\\nlet total_sample_count = (\\r\\nrequests\\r\\n| summarize total_count_samples = sum(count_samples) by machine_name, server_name\\r\\n);\\r\\n// typical count of samples per machine, server in selected time range\\r\\nlet expected_sample_count = toscalar(\\r\\ntotal_sample_count\\r\\n| summarize percentile(total_count_samples, 90)\\r\\n);\\r\\nlet requests_timeline = \\r\\n(\\r\\nrequests\\r\\n| lookup total_sample_count on machine_name, server_name\\r\\n| make-series requests_timeline = avg(requests_rate) default = long(null) on binned_sample_time_utc from {timeRange:start} to {timeRange:end} step {timeRange:grain} by machine_name, server_name\\r\\n);\\r\\nlet server_properties = (\\r\\nsqlserver_properties\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize arg_max(sample_time_utc, cluster_name) by machine_name, server_name\\r\\n);\\r\\nlet agg_requests = (\\r\\nrequests\\r\\n| lookup total_sample_count on machine_name, server_name\\r\\n| summarize requests_rate = sum(requests_rate * toreal(count_samples) / toreal(total_count_samples)), // weighted average\\r\\n            count_samples = sum(count_samples)\\r\\n            by machine_name, server_name\\r\\n| join kind=leftouter requests_timeline on machine_name, server_name\\r\\n| join kind=leftouter server_properties on machine_name, server_name\\r\\n| project machine_name, server_name, cluster_name, requests_rate = iif(toreal(count_samples)/expected_sample_count < 0.5, real(null), requests_rate), requests_timeline,\\r\\n          grouper = case(\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"machine\\\", machine_name,\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"cluster\\\", cluster_name,\\r\\n                        server_name\\r\\n                        )\\r\\n);\\r\\n// Get the max value across servers in each grouper. This is used to limit to top N servers without tearing groups (machines, clusters).\\r\\nlet agg_requests_grouper = (\\r\\nagg_requests\\r\\n| summarize requests_rate = max(requests_rate) by grouper\\r\\n| sort by requests_rate desc\\r\\n| project grouper, requests_rate, grouper_number = row_number()\\r\\n);\\r\\nagg_requests\\r\\n| lookup agg_requests_grouper on grouper\\r\\n| where grouper_number <= 50 // limit to top hitters\\r\\n| project machine_name, server_name, cluster_name, requests_rate, grouper_requests_rate = requests_rate1, requests_timeline, grouper = iif(\\\"{HeatmapGroupBy}\\\" == \\\"none\\\", \\\"\\\", grouper)\\r\\n| sort by tolower(grouper) asc, tolower(machine_name) asc, tolower(server_name) asc\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "showAnalytics": true,
        "noDataMessage": "There is no data for specified parameters.",
        "showExportToExcel": true,
        "queryType": 9,
        "visualization": "graph",
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "server_name",
            "formatter": 1,
            "formatOptions": {
              "linkTarget": "WorkbookTemplate",
              "workbookContext": {
                "componentIdSource": "workbook",
                "resourceIdsSource": "workbook",
                "templateIdSource": "static",
                "templateId": "Community-Workbooks/Database watcher/SQL Server/instance",
                "typeSource": "workbook",
                "gallerySource": "default",
                "locationSource": "workbook",
                "workbookName": "SQL Server instance",
                "passSpecificParams": true,
                "templateParameters": [
                  {
                    "name": "machineName",
                    "source": "column",
                    "value": "machine_name"
                  },
                  {
                    "name": "serverName",
                    "source": "column",
                    "value": "server_name"
                  },
                  {
                    "name": "timeRange",
                    "source": "parameter",
                    "value": "timeRange"
                  },
                  {
                    "name": "linkAdxClusterUri",
                    "source": "parameter",
                    "value": "adxClusterUri"
                  },
                  {
                    "name": "linkAdxDatabase",
                    "source": "parameter",
                    "value": "adxDatabase"
                  },
                  {
                    "name": "tabName",
                    "source": "static",
                    "value": "Overview"
                  },
                  {
                    "name": "showDescriptions",
                    "source": "parameter",
                    "value": "showDescriptions"
                  }
                ]
              }
            }
          },
          "centerContent": {
            "columnMatch": "requests_rate",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "numberFormat": {
              "unit": 31,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 1
              },
              "emptyValCustomText": "N/A"
            },
            "tooltipFormat": {
              "tooltip": "Average batch requests rate for selected time range. Shows \"N/A\" if the number of samples is insufficient."
            }
          },
          "bottomContent": {
            "columnMatch": "requests_timeline",
            "formatter": 21,
            "formatOptions": {
              "palette": "blue"
            },
            "tooltipFormat": {
              "tooltip": "Average batch requests rate over selected time range"
            }
          },
          "hivesContent": {
            "columnMatch": "grouper",
            "formatter": 1
          },
          "nodeIdField": "server_name",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 150,
          "colorSettings": {
            "nodeColorField": "requests_rate",
            "type": 4,
            "heatmapPalette": "coldHot",
            "heatmapMin": null,
            "heatmapMax": null,
            "emptyValueColor": "gray"
          },
          "groupByField": "grouper",
          "hivesMargin": 5
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "sqlserver_performance_counters_common",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "sqlserver_properties",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Heatmaps"
        },
        {
          "parameterName": "heatmapTabName",
          "comparison": "isEqualTo",
          "value": "Requests"
        }
      ],
      "name": "requests_heatmap"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let waits = materialize (\\r\\nsqlserver_wait_stats\\r\\n| where sample_time_utc between (({timeRange:start} - {timeRange:grain}) .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| where wait_type startswith(\\\"LCK_M_\\\")\\r\\n| partition hint.strategy = shuffle by machine_name\\r\\n(\\r\\nsummarize wait_time_ms = sum(wait_time_ms) by machine_name, server_name, sample_time_utc\\r\\n| sort by server_name asc, sample_time_utc asc\\r\\n| extend delta_wait_time_ms = iif(wait_time_ms >= prev(wait_time_ms) and server_name == prev(server_name), wait_time_ms - prev(wait_time_ms), long(null)),\\r\\n         delta_sample_time_utc = iif(sample_time_utc >= prev(sample_time_utc), datetime_diff(\\\"Millisecond\\\", sample_time_utc, prev(sample_time_utc)), long(null))\\r\\n| where isnotempty(delta_sample_time_utc)\\r\\n| extend value = toreal(delta_wait_time_ms) / delta_sample_time_utc * 1000\\r\\n| summarize wait_ms_per_second = avg(value), count_samples = dcount(sample_time_utc) by machine_name, server_name, binned_sample_time_utc = bin(sample_time_utc, {timeRange:grain})\\r\\n)\\r\\n);\\r\\n// total count of samples per server in selected time range\\r\\nlet total_sample_count = (\\r\\nsqlserver_wait_stats\\r\\n| where sample_time_utc between (({timeRange:start} - {timeRange:grain}) .. {timeRange:end})\\r\\n| summarize total_count_samples = dcount(sample_time_utc) by machine_name, server_name\\r\\n);\\r\\n// typical count of samples per server in selected time range\\r\\nlet expected_sample_count = toscalar(\\r\\ntotal_sample_count\\r\\n| summarize percentile(total_count_samples, 90)\\r\\n);\\r\\nlet metric_timeline = (\\r\\nwaits\\r\\n| lookup total_sample_count on machine_name, server_name\\r\\n| make-series waits_timeline = avg(wait_ms_per_second) default = long(null) on binned_sample_time_utc from {timeRange:start} to {timeRange:end} step {timeRange:grain} by machine_name, server_name\\r\\n);\\r\\nlet server_properties = (\\r\\nsqlserver_properties\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize arg_max(sample_time_utc, cluster_name) by machine_name, server_name\\r\\n);\\r\\nlet agg_waits = (\\r\\nwaits\\r\\n| lookup total_sample_count on machine_name, server_name\\r\\n| summarize wait_ms_per_second = sum(wait_ms_per_second * toreal(count_samples) / toreal(total_count_samples)), // weighted average\\r\\n            count_samples = sum(count_samples)\\r\\n            by machine_name, server_name\\r\\n| join kind=leftouter metric_timeline on machine_name, server_name\\r\\n| join kind=leftouter server_properties on machine_name, server_name\\r\\n| project machine_name,\\r\\n          server_name,\\r\\n          cluster_name,\\r\\n          wait_ms_per_second = case(\\r\\n                                   isnull(count_samples) or count_samples == 0, real(0),\\r\\n                                   toreal(count_samples)/expected_sample_count < 0.5, real(null),\\r\\n                                   wait_ms_per_second\\r\\n                                   ),\\r\\n          waits_timeline,\\r\\n          grouper = case(\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"machine\\\", machine_name,\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"cluster\\\", cluster_name,\\r\\n                        server_name\\r\\n                        )\\r\\n);\\r\\n// Get the max value across servers in each grouper. This is used to limit to top N servers without tearing groups (machines, clusters).\\r\\nlet agg_waits_grouper = (\\r\\nagg_waits\\r\\n| summarize wait_ms_per_second = max(wait_ms_per_second) by grouper\\r\\n| sort by wait_ms_per_second desc\\r\\n| project grouper, wait_ms_per_second, grouper_number = row_number()\\r\\n);\\r\\nagg_waits\\r\\n| lookup agg_waits_grouper on grouper\\r\\n| where grouper_number <= 50 // limit to top hitters\\r\\n| project machine_name, server_name, cluster_name, wait_ms_per_second, grouper_wait_ms_per_second = wait_ms_per_second1, waits_timeline, grouper = iif(\\\"{HeatmapGroupBy}\\\" == \\\"none\\\", \\\"\\\", grouper)\\r\\n| sort by tolower(grouper) asc, tolower(machine_name) asc, tolower(server_name) asc\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "showAnalytics": true,
        "noDataMessage": "There is no data for specified parameters.",
        "showExportToExcel": true,
        "queryType": 9,
        "visualization": "graph",
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "server_name",
            "formatter": 1,
            "formatOptions": {
              "linkTarget": "WorkbookTemplate",
              "workbookContext": {
                "componentIdSource": "workbook",
                "resourceIdsSource": "workbook",
                "templateIdSource": "static",
                "templateId": "Community-Workbooks/Database watcher/SQL Server/instance",
                "typeSource": "workbook",
                "gallerySource": "default",
                "locationSource": "workbook",
                "workbookName": "SQL Server instance",
                "passSpecificParams": true,
                "templateParameters": [
                  {
                    "name": "machineName",
                    "source": "column",
                    "value": "machine_name"
                  },
                  {
                    "name": "serverName",
                    "source": "column",
                    "value": "server_name"
                  },
                  {
                    "name": "timeRange",
                    "source": "parameter",
                    "value": "timeRange"
                  },
                  {
                    "name": "linkAdxClusterUri",
                    "source": "parameter",
                    "value": "adxClusterUri"
                  },
                  {
                    "name": "linkAdxDatabase",
                    "source": "parameter",
                    "value": "adxDatabase"
                  },
                  {
                    "name": "tabName",
                    "source": "static",
                    "value": "Overview"
                  },
                  {
                    "name": "showDescriptions",
                    "source": "parameter",
                    "value": "showDescriptions"
                  }
                ]
              }
            }
          },
          "centerContent": {
            "columnMatch": "wait_ms_per_second",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "numberFormat": {
              "unit": 23,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 1
              },
              "emptyValCustomText": "N/A"
            },
            "tooltipFormat": {
              "tooltip": "Cumulative wait time (in milliseconds per second) averaged over selected time range. Shows \"N/A\" if the number of samples is insufficient."
            }
          },
          "bottomContent": {
            "columnMatch": "waits_timeline",
            "formatter": 21,
            "formatOptions": {
              "palette": "blue"
            },
            "tooltipFormat": {
              "tooltip": "Cumulative lock waits over selected time range"
            }
          },
          "hivesContent": {
            "columnMatch": "grouper",
            "formatter": 1
          },
          "nodeIdField": "server_name",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 150,
          "colorSettings": {
            "nodeColorField": "wait_ms_per_second",
            "type": 4,
            "heatmapPalette": "greenRed",
            "heatmapMin": null,
            "heatmapMax": null,
            "emptyValueColor": "gray"
          },
          "groupByField": "grouper",
          "hivesMargin": 5
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "sqlserver_performance_counters_common",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "sqlserver_properties",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Heatmaps"
        },
        {
          "parameterName": "heatmapTabName",
          "comparison": "isEqualTo",
          "value": "Lock waits"
        }
      ],
      "name": "blocking_heatmap"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"// typical count of samples per machine, server in selected time range\\r\\nlet expected_sample_count = toscalar(\\r\\nsqlserver_database_replicas\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize count_samples = dcount(sample_time_utc) by machine_name, server_name\\r\\n| summarize percentile(count_samples, 90)\\r\\n);\\r\\nlet server_properties = (\\r\\nsqlserver_properties\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize arg_max(sample_time_utc, cluster_name) by machine_name, server_name\\r\\n);\\r\\nlet agg_hadr_health = (\\r\\nsqlserver_database_replicas\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n// define health status of an availability database represented by a row\\r\\n| extend availability_database_health = case(\\r\\n                                            is_suspended\\r\\n                                            or\\r\\n                                            database_replica_synchronization_state_desc in (\\\"NOT SYNCHRONIZING\\\",\\\"REVERTING\\\",\\\"INITIALIZING\\\")\\r\\n                                            or\\r\\n                                            database_replica_synchronization_health_desc in (\\\"NOT_HEALTHY\\\",\\\"PARTIALLY_HEALTHY\\\")\\r\\n                                            or\\r\\n                                            database_state_desc in (\\\"RESTORING\\\",\\\"RECOVERING\\\",\\\"RECOVERY_PENDING\\\",\\\"SUSPECT\\\",\\\"EMERGENCY\\\",\\\"OFFLINE\\\")\\r\\n                                            or\\r\\n                                            replica_role_desc in (\\\"RESOLVING\\\")\\r\\n                                            or\\r\\n                                            replica_operational_state_desc in (\\\"PENDING\\\",\\\"PENDING_FAILOVER\\\",\\\"OFFLINE\\\",\\\"FAILED\\\",\\\"FAILED_NO_QUORUM\\\")\\r\\n                                            or\\r\\n                                            replica_connected_state_desc in (\\\"DISCONNECTED\\\")\\r\\n                                            or\\r\\n                                            replica_recovery_health_desc in (\\\"ONLINE_IN_PROGRESS\\\")\\r\\n                                            or\\r\\n                                            replica_synchronization_health_desc in (\\\"NOT_HEALTHY\\\",\\\"PARTIALLY_HEALTHY\\\"),\\r\\n                                            \\\"unhealthy\\\",\\r\\n                                            \\\"healthy\\\"\\r\\n                                            )\\r\\n// a sample is unhealthy if at least one availability database is unhealthy\\r\\n| summarize sample_type = case(\\r\\n                              countif(availability_database_health == \\\"unhealthy\\\") > 0, \\\"unhealthy\\\",\\r\\n                              countif(availability_database_health == \\\"healthy\\\") > 0, \\\"healthy\\\",\\r\\n                              \\\"\\\"\\r\\n                              )\\r\\n            by machine_name, server_name, sample_time_utc\\r\\n| summarize count_unhealthy_samples = countif(sample_type == \\\"unhealthy\\\"),\\r\\n            count_healthy_samples = countif(sample_type == \\\"healthy\\\"),\\r\\n            count_samples = count()\\r\\n            by machine_name, server_name\\r\\n| join kind=leftouter server_properties on machine_name, server_name\\r\\n| project machine_name, server_name, cluster_name, health_ratio = iif(toreal(count_samples)/expected_sample_count < 0.5, real(null), toreal(count_healthy_samples) / toreal(count_samples)), count_unhealthy_samples = iif(count_unhealthy_samples > 0, count_unhealthy_samples, int(null)),\\r\\n          color = case(\\r\\n                      toreal(count_samples)/expected_sample_count < 0.5, \\\"gray\\\", // show color as grey (unknown) if the number of samples is much less than the representative number across all servers\\r\\n                      count_unhealthy_samples > 0, \\\"red\\\",\\r\\n                      count_healthy_samples > 0, \\\"green\\\",\\r\\n                      \\\"\\\"\\r\\n                      ),\\r\\n          grouper = case(\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"machine\\\", machine_name,\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"cluster\\\", cluster_name,\\r\\n                        server_name\\r\\n                        )\\r\\n);\\r\\n// Get the max value across servers in each grouper. This is used to limit to top N servers without tearing groups (machines, clusters).\\r\\nlet agg_hadr_health_grouper = (\\r\\nagg_hadr_health\\r\\n| summarize health_ratio = min(health_ratio) by grouper\\r\\n| sort by health_ratio asc\\r\\n| project grouper, health_ratio, grouper_number = row_number()\\r\\n);\\r\\nagg_hadr_health\\r\\n| lookup agg_hadr_health_grouper on grouper\\r\\n| where grouper_number <= 50 // limit to top hitters\\r\\n| project machine_name, server_name, cluster_name, health_ratio, grouper_health_ratio = health_ratio1, count_unhealthy_samples, color, grouper = iif(\\\"{HeatmapGroupBy}\\\" == \\\"none\\\", \\\"\\\", grouper)\\r\\n| sort by tolower(grouper) asc, tolower(machine_name) asc, tolower(server_name) asc\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "showAnalytics": true,
        "noDataMessage": "There is no data for specified parameters.",
        "showExportToExcel": true,
        "queryType": 9,
        "visualization": "graph",
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "server_name",
            "formatter": 1,
            "formatOptions": {
              "linkTarget": "WorkbookTemplate",
              "workbookContext": {
                "componentIdSource": "workbook",
                "resourceIdsSource": "workbook",
                "templateIdSource": "static",
                "templateId": "Community-Workbooks/Database watcher/SQL Server/instance",
                "typeSource": "workbook",
                "gallerySource": "default",
                "locationSource": "workbook",
                "workbookName": "SQL Server instance",
                "passSpecificParams": true,
                "templateParameters": [
                  {
                    "name": "machineName",
                    "source": "column",
                    "value": "machine_name"
                  },
                  {
                    "name": "serverName",
                    "source": "column",
                    "value": "server_name"
                  },
                  {
                    "name": "timeRange",
                    "source": "parameter",
                    "value": "timeRange"
                  },
                  {
                    "name": "linkAdxClusterUri",
                    "source": "parameter",
                    "value": "adxClusterUri"
                  },
                  {
                    "name": "linkAdxDatabase",
                    "source": "parameter",
                    "value": "adxDatabase"
                  },
                  {
                    "name": "tabName",
                    "source": "static",
                    "value": "Replicas"
                  },
                  {
                    "name": "showDescriptions",
                    "source": "parameter",
                    "value": "showDescriptions"
                  }
                ]
              },
              "bladeOpenContext": {
                "bladeParameters": []
              }
            }
          },
          "centerContent": {
            "columnMatch": "health_ratio",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "numberFormat": {
              "unit": 0,
              "options": {
                "style": "percent",
                "minimumFractionDigits": 2
              },
              "emptyValCustomText": "N/A"
            },
            "tooltipFormat": {
              "tooltip": "The ratio of samples where all availability databases and replicas were healthy to total samples, as a percentage. Shows \"N/A\" if the number of samples is insufficient."
            }
          },
          "bottomContent": {
            "columnMatch": "count_unhealthy_samples",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "tooltipFormat": {
              "tooltip": "The number of samples in selected time range where at least one availability database or replica was unhealthy"
            }
          },
          "hivesContent": {
            "columnMatch": "grouper",
            "formatter": 1
          },
          "nodeIdField": "server_name",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 150,
          "colorSettings": {
            "nodeColorField": "color",
            "type": 3,
            "thresholdsGrid": [
              {
                "operator": "==",
                "thresholdValue": "gray",
                "representation": "gray"
              },
              {
                "operator": "==",
                "thresholdValue": "red",
                "representation": "red"
              },
              {
                "operator": "==",
                "thresholdValue": "green",
                "representation": "green"
              },
              {
                "operator": "Default",
                "thresholdValue": null
              }
            ]
          },
          "groupByField": "grouper",
          "hivesMargin": 5
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "sqlserver_database_replicas",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "sqlserver_properties",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Heatmaps"
        },
        {
          "parameterName": "heatmapTabName",
          "comparison": "isEqualTo",
          "value": "Availability group health"
        }
      ],
      "name": "availability_group_health_heatmap"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"// Map connection server name to target server/machine name\\r\\nlet connection_server_target = materialize (\\r\\nsqlserver_connectivity\\r\\n| where probe_time_utc between (({timeRange:start} - 1h) .. ({timeRange:end} + 1h))\\r\\n| where probe_return_value == 1\\r\\n| summarize arg_max(probe_time_utc, server_name, machine_name) by connection_server_name\\r\\n| project-away probe_time_utc\\r\\n);\\r\\n// typical count of probes per machine, server in selected time range\\r\\nlet expected_probe_count = toscalar(\\r\\nsqlserver_connectivity\\r\\n| where probe_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize count_samples = dcount(probe_time_utc) by machine_name, server_name\\r\\n| summarize percentile(count_samples, 90)\\r\\n);\\r\\nlet server_properties = (\\r\\nsqlserver_properties\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize arg_max(sample_time_utc, cluster_name) by machine_name, server_name\\r\\n);\\r\\nlet agg_connectivity = (\\r\\nsqlserver_connectivity\\r\\n| where probe_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n| lookup connection_server_target on connection_server_name // A failed probe has empty machine_name/server_name. Look them up for the most recent successful probe with the same connection server name.\\r\\n| extend machine_name = iif(isempty(machine_name), machine_name1, machine_name),\\r\\n         server_name = iif(isempty(server_name), server_name1, server_name)\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize count_failed_probes = countif(probe_return_value != 1),\\r\\n            count_successful_probes = countif(probe_return_value == 1),\\r\\n            count_probes = count()\\r\\n            by machine_name, server_name\\r\\n| join kind=leftouter server_properties on machine_name, server_name\\r\\n| project machine_name, server_name, cluster_name, health_ratio = iif(toreal(count_probes)/expected_probe_count < 0.5, real(null), toreal(count_successful_probes) / toreal(count_probes)), count_failed_probes = iif(count_failed_probes > 0, count_failed_probes, int(null)),\\r\\n          color = case(\\r\\n                      toreal(count_probes)/expected_probe_count < 0.5, \\\"gray\\\", // show color as grey (unknown) if the number of samples is much less than the representative number across all servers\\r\\n                      count_failed_probes > 0, \\\"red\\\",\\r\\n                      count_successful_probes > 0, \\\"green\\\",\\r\\n                      \\\"\\\"\\r\\n                      ),\\r\\n          grouper = case(\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"machine\\\", machine_name,\\r\\n                        \\\"{HeatmapGroupBy}\\\" == \\\"cluster\\\", cluster_name,\\r\\n                        server_name\\r\\n                        )\\r\\n);\\r\\n// Get the max value across servers in each grouper. This is used to limit to top N servers without tearing groups (machines, clusters).\\r\\nlet agg_connectivity_grouper = (\\r\\nagg_connectivity\\r\\n| summarize health_ratio = min(health_ratio) by grouper\\r\\n| sort by health_ratio asc\\r\\n| project grouper, health_ratio, grouper_number = row_number()\\r\\n);\\r\\nagg_connectivity\\r\\n| lookup agg_connectivity_grouper on grouper\\r\\n| where grouper_number <= 50 // limit to top hitters\\r\\n| project machine_name, server_name, cluster_name, health_ratio, grouper_health_ratio = health_ratio1, count_failed_probes, color, grouper = iif(\\\"{HeatmapGroupBy}\\\" == \\\"none\\\", \\\"\\\", grouper)\\r\\n| sort by tolower(grouper) asc, tolower(machine_name) asc, tolower(server_name) asc\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "showAnalytics": true,
        "noDataMessage": "There is no data for specified parameters.",
        "showExportToExcel": true,
        "queryType": 9,
        "visualization": "graph",
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "server_name",
            "formatter": 1,
            "formatOptions": {
              "linkTarget": "WorkbookTemplate",
              "workbookContext": {
                "componentIdSource": "workbook",
                "resourceIdsSource": "workbook",
                "templateIdSource": "static",
                "templateId": "Community-Workbooks/Database watcher/SQL Server/instance",
                "typeSource": "workbook",
                "gallerySource": "default",
                "locationSource": "workbook",
                "workbookName": "SQL Server instance",
                "passSpecificParams": true,
                "templateParameters": [
                  {
                    "name": "machineName",
                    "source": "column",
                    "value": "machine_name"
                  },
                  {
                    "name": "serverName",
                    "source": "column",
                    "value": "server_name"
                  },
                  {
                    "name": "timeRange",
                    "source": "parameter",
                    "value": "timeRange"
                  },
                  {
                    "name": "linkAdxClusterUri",
                    "source": "parameter",
                    "value": "adxClusterUri"
                  },
                  {
                    "name": "linkAdxDatabase",
                    "source": "parameter",
                    "value": "adxDatabase"
                  },
                  {
                    "name": "tabName",
                    "source": "static",
                    "value": "Connectivity"
                  },
                  {
                    "name": "showDescriptions",
                    "source": "parameter",
                    "value": "showDescriptions"
                  }
                ]
              },
              "bladeOpenContext": {
                "bladeParameters": []
              }
            }
          },
          "centerContent": {
            "columnMatch": "health_ratio",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "numberFormat": {
              "unit": 0,
              "options": {
                "style": "percent",
                "minimumFractionDigits": 2
              },
              "emptyValCustomText": "N/A"
            },
            "tooltipFormat": {
              "tooltip": "The ratio of successful connectivity probes to total connectivity probes, as a percentage. Shows \"N/A\" if the number of probes is insufficient."
            }
          },
          "bottomContent": {
            "columnMatch": "count_failed_probes",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "tooltipFormat": {
              "tooltip": "The number of failed connectivity probes in selected time range"
            }
          },
          "hivesContent": {
            "columnMatch": "grouper",
            "formatter": 1
          },
          "nodeIdField": "server_name",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 150,
          "colorSettings": {
            "nodeColorField": "color",
            "type": 3,
            "thresholdsGrid": [
              {
                "operator": "==",
                "thresholdValue": "gray",
                "representation": "gray"
              },
              {
                "operator": "==",
                "thresholdValue": "red",
                "representation": "red"
              },
              {
                "operator": "==",
                "thresholdValue": "green",
                "representation": "green"
              },
              {
                "operator": "Default",
                "thresholdValue": null
              }
            ]
          },
          "groupByField": "grouper",
          "hivesMargin": 5
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "sqlserver_connectivity",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "sqlserver_properties",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Heatmaps"
        },
        {
          "parameterName": "heatmapTabName",
          "comparison": "isEqualTo",
          "value": "Connectivity"
        }
      ],
      "name": "connectivity_heatmap"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let last_volume_storage_sample = sqlserver_volume_storage_utilization\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize arg_max(sample_time_utc, available_mb, total_mb) by machine_name, server_name, volume_id\\r\\n| summarize count_volumes = count(),\\r\\n            count_low_space_volumes = countif(toreal(toreal(available_mb) / total_mb) <= 0.1) by machine_name, server_name\\r\\n;\\r\\nlet databases = sqlserver_database_properties\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize arg_max(sample_time_utc, notable_db_scoped_configs, compatibility_level, is_auto_create_stats_on, is_auto_shrink_on, is_auto_update_stats_on, user_access_desc, force_last_good_plan_actual_state, query_store_actual_state_desc, state_desc, page_verify_option_desc, log_reuse_wait_desc, last_good_checkdb_time, database_name, updateability) by machine_name, server_name, database_id\\r\\n| extend db_scoped_configs = todynamic(notable_db_scoped_configs)\\r\\n| mv-expand db_scoped_configs\\r\\n| mv-expand db_scoped_config_name = db_scoped_configs.name to typeof(string), db_scoped_config_value = db_scoped_configs.value to typeof(string), db_scoped_config_value_for_secondary = db_scoped_configs.value_for_secondary to typeof(string)\\r\\n| where db_scoped_config_name == \\\"MAXDOP\\\" or db_scoped_config_name == \\\"\\\"\\r\\n| join kind=leftouter (\\r\\n                      sqlserver_properties\\r\\n                      | where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n                      {machineNameFilter}\\r\\n                      {serverNameFilter}\\r\\n                      | summarize arg_max(sample_time_utc, logical_cpu_count) by machine_name, server_name\\r\\n                      ) on machine_name, server_name\\r\\n| summarize count_databases = count(),\\r\\n            count_databases_with_warnings = countif(\\r\\n                                                   db_scoped_config_name == \\\"MAXDOP\\\" and logical_cpu_count > 8 and (toint(db_scoped_config_value) > 8 or toint(db_scoped_config_value_for_secondary) > 8)\\r\\n                                                   or\\r\\n                                                   compatibility_level <= 110\\r\\n                                                   or\\r\\n                                                   is_auto_create_stats_on == false\\r\\n                                                   or\\r\\n                                                   is_auto_shrink_on == true\\r\\n                                                   or\\r\\n                                                   is_auto_update_stats_on == false\\r\\n                                                   or\\r\\n                                                   user_access_desc != \\\"MULTI_USER\\\"\\r\\n                                                   or\\r\\n                                                   force_last_good_plan_actual_state != \\\"ON\\\" and updateability == \\\"READ_WRITE\\\" and database_name !in (\\\"master\\\",\\\"tempdb\\\",\\\"model\\\",\\\"msdb\\\")\\r\\n                                                   or\\r\\n                                                   query_store_actual_state_desc != \\\"READ_WRITE\\\" and updateability == \\\"READ_WRITE\\\" and database_name !in (\\\"master\\\",\\\"tempdb\\\",\\\"model\\\",\\\"msdb\\\")\\r\\n                                                   or\\r\\n                                                   state_desc != \\\"ONLINE\\\"\\r\\n                                                   or\\r\\n                                                   page_verify_option_desc != \\\"CHECKSUM\\\"\\r\\n                                                   or\\r\\n                                                   log_reuse_wait_desc !in~ (\\\"NOTHING\\\",\\\"OLDEST_PAGE\\\",\\\"LOG_SCAN\\\",\\\"DATABASE_SNAPSHOT_CREATION\\\",\\\"CHECKPOINT\\\")\\r\\n                                                   or\\r\\n                                                   last_good_checkdb_time == datetime(\\\"1900-01-01T00:00:00Z\\\") and database_name !~ \\\"tempdb\\\"\\r\\n                                                   )\\r\\n            by machine_name, server_name\\r\\n;\\r\\nsqlserver_properties\\r\\n| where sample_time_utc between ({timeRange:start} .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize arg_max(sample_time_utc, cluster_name, database_engine_start_time_utc, database_engine_memory_model, quorum_state_desc, is_clustered, is_availability_groups_enabled, server_maxdop, logical_cpu_count, fill_factor_percent, ipall_dynamic_ports, count_dumps, backup_checksum_default, is_instant_file_initialization_enabled, max_server_memory_mb) by machine_name, server_name\\r\\n| extend count_warnings = iif(database_engine_memory_model in (\\\"CONVENTIONAL\\\",\\\"LARGE_PAGES\\\"), 1, 0)\\r\\n                          +\\r\\n                          iif(quorum_state_desc == \\\"NORMAL_QUORUM\\\" and (is_clustered == 1 or is_availability_groups_enabled == 1), 1, 0)\\r\\n                          +\\r\\n                          iif((server_maxdop > 8 or server_maxdop == 0) and logical_cpu_count > 8, 1, 0)\\r\\n                          +\\r\\n                          iif(fill_factor_percent !in (0,100), 1, 0)\\r\\n                          +\\r\\n                          iif(ipall_dynamic_ports == 0, 1, 0)\\r\\n                          +\\r\\n                          iif(count_dumps != 0, 1, 0)\\r\\n                          +\\r\\n                          iif(backup_checksum_default == false, 1, 0)\\r\\n                          +\\r\\n                          iif(is_instant_file_initialization_enabled == false, 1, 0)\\r\\n                          +\\r\\n                          iif(max_server_memory_mb == 2147483647, 1, 0)\\r\\n| join kind=leftouter last_volume_storage_sample on machine_name, server_name\\r\\n| join kind=leftouter databases on machine_name, server_name\\r\\n| project server_name, count_warnings, machine_name, cluster_name, uptime = datetime_diff(\\\"minute\\\", now(), database_engine_start_time_utc), count_databases, count_databases_with_warnings, count_volumes, count_low_space_volumes, formatted_uptime = format_timespan(1s * datetime_diff(\\\"second\\\", now(), database_engine_start_time_utc), \\\"d.hh:mm:ss\\\")\\r\\n| sort by tolower(cluster_name) asc, tolower(machine_name) asc, tolower(server_name) asc\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 0,
        "showAnalytics": true,
        "noDataMessage": "There is no data for specified parameters.",
        "showExportToExcel": true,
        "queryType": 9,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "server_name",
              "formatter": 5,
              "tooltipFormat": {
                "tooltip": ""
              }
            },
            {
              "columnMatch": "count_warnings",
              "formatter": 18,
              "formatOptions": {
                "linkTarget": "WorkbookTemplate",
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "0",
                    "representation": "Sev4",
                    "text": "[\"server_name\"]"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "1",
                    "representation": "Sev3",
                    "text": "[\"server_name\"]"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "3",
                    "representation": "Sev2",
                    "text": "[\"server_name\"]"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "6",
                    "representation": "Sev1",
                    "text": "[\"server_name\"]"
                  },
                  {
                    "operator": ">=",
                    "thresholdValue": "7",
                    "representation": "Sev0",
                    "text": "[\"server_name\"]"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "more",
                    "text": "[\"server_name\"]"
                  }
                ],
                "workbookContext": {
                  "componentIdSource": "workbook",
                  "resourceIdsSource": "workbook",
                  "templateIdSource": "static",
                  "templateId": "Community-Workbooks/Database watcher/SQL Server/instance",
                  "typeSource": "workbook",
                  "gallerySource": "default",
                  "locationSource": "workbook",
                  "workbookName": "SQL Server instance",
                  "passSpecificParams": true,
                  "templateParameters": [
                    {
                      "name": "serverName",
                      "source": "column",
                      "value": "server_name"
                    },
                    {
                      "name": "machineName",
                      "source": "column",
                      "value": "machine_name"
                    },
                    {
                      "name": "timeRange",
                      "source": "parameter",
                      "value": "timeRange"
                    },
                    {
                      "name": "linkAdxClusterUri",
                      "source": "parameter",
                      "value": "adxClusterUri"
                    },
                    {
                      "name": "linkAdxDatabase",
                      "source": "parameter",
                      "value": "adxDatabase"
                    },
                    {
                      "name": "tabName",
                      "source": "static",
                      "value": "Overview"
                    },
                    {
                      "name": "showDescriptions",
                      "source": "parameter",
                      "value": "showDescriptions"
                    }
                  ]
                },
                "customColumnWidthSetting": "25ch"
              },
              "tooltipFormat": {
                "tooltip": "There are [\"count_warnings\"] configuration or state warnings for [\"server_name\"]. Click on the server (SQL instance) name to see details."
              }
            },
            {
              "columnMatch": "machine_name",
              "formatter": 0,
              "tooltipFormat": {
                "tooltip": "Computer (aka machine, aka node) name where this SQL Server instance is running"
              }
            },
            {
              "columnMatch": "cluster_name",
              "formatter": 0,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "Not clustered"
              },
              "tooltipFormat": {
                "tooltip": "Cluster name for Availability Group (AG) clusters or Failover Cluster Instance (FCI) clusters"
              }
            },
            {
              "columnMatch": "uptime",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "<=",
                    "thresholdValue": "1440",
                    "representation": "green",
                    "text": "[\"formatted_uptime\"]"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "[\"formatted_uptime\"]"
                  }
                ]
              },
              "tooltipFormat": {
                "tooltip": "SQL Server instance uptime, as days.hours:minutes:seconds. Highlighted in green for recently started instances."
              }
            },
            {
              "columnMatch": "count_databases",
              "formatter": 5
            },
            {
              "columnMatch": "count_databases_with_warnings",
              "formatter": 18,
              "formatOptions": {
                "linkTarget": "WorkbookTemplate",
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "0",
                    "representation": "Sev4",
                    "text": "[\"count_databases\"] databases"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "1",
                    "representation": "Sev3",
                    "text": "[\"count_databases\"] databases"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "3",
                    "representation": "Sev2",
                    "text": "[\"count_databases\"] databases"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "6",
                    "representation": "Sev1",
                    "text": "[\"count_databases\"] databases"
                  },
                  {
                    "operator": ">=",
                    "thresholdValue": "7",
                    "representation": "Sev0",
                    "text": "[\"count_databases\"] databases"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "more",
                    "text": "[\"count_databases\"] databases"
                  }
                ],
                "workbookContext": {
                  "componentIdSource": "workbook",
                  "resourceIdsSource": "workbook",
                  "templateIdSource": "static",
                  "templateId": "Community-Workbooks/Database watcher/SQL Server/instance",
                  "typeSource": "workbook",
                  "gallerySource": "default",
                  "locationSource": "workbook",
                  "workbookName": "SQL Server instance",
                  "passSpecificParams": true,
                  "templateParameters": [
                    {
                      "name": "machineName",
                      "source": "column",
                      "value": "machine_name"
                    },
                    {
                      "name": "serverName",
                      "source": "column",
                      "value": "server_name"
                    },
                    {
                      "name": "timeRange",
                      "source": "parameter",
                      "value": "timeRange"
                    },
                    {
                      "name": "tabName",
                      "source": "static",
                      "value": "Databases"
                    },
                    {
                      "name": "linkAdxClusterUri",
                      "source": "parameter",
                      "value": "adxClusterUri"
                    },
                    {
                      "name": "linkAdxDatabase",
                      "source": "parameter",
                      "value": "adxDatabase"
                    },
                    {
                      "name": "showDescriptions",
                      "source": "parameter",
                      "value": "showDescriptions"
                    }
                  ]
                }
              },
              "tooltipFormat": {
                "tooltip": "[\"count_databases_with_warnings\"] out of [\"count_databases\"] databases on [\"server_name\"] have configuration or state warnings. Click to see details."
              }
            },
            {
              "columnMatch": "count_volumes",
              "formatter": 5
            },
            {
              "columnMatch": "count_low_space_volumes",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "0",
                    "representation": "success",
                    "text": "[\"count_volumes\"] volumes"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "1",
                    "representation": "3",
                    "text": "Space low on {0} out of [\"count_volumes\"] volumes"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Blank",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "34ch"
              },
              "tooltipFormat": {
                "tooltip": "A volume is considered low on space when it has less than 10% space available"
              }
            },
            {
              "columnMatch": "formatted_uptime",
              "formatter": 5
            }
          ],
          "filter": true,
          "labelSettings": [
            {
              "columnId": "count_warnings",
              "label": "Server"
            },
            {
              "columnId": "machine_name",
              "label": "Machine"
            },
            {
              "columnId": "cluster_name",
              "label": "Cluster"
            },
            {
              "columnId": "uptime",
              "label": "Uptime"
            },
            {
              "columnId": "count_databases_with_warnings",
              "label": "Databases"
            },
            {
              "columnId": "count_low_space_volumes",
              "label": "Storage volumes"
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "sqlserver_properties",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Servers"
        },
        {
          "parameterName": "sqlserver_volume_storage_utilization",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "sqlserver_database_properties",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "matchPattern",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "sql_servers"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "448a29bd-9c86-4cc9-b114-e89eb4532388",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsStartTime",
                  "type": 1,
                  "isRequired": true,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"union\\r\\n(\\r\\n// The most recent interval that is earlier than the end of time range.\\r\\n// This may be earlier than the start of time range by at most 2h.\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_start_time between (({timeRange:start} - 2h) .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize interval_start_time = max(interval_start_time)\\r\\n),\\r\\n(\\r\\n// earliest interval start within time range\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_end_time >= {timeRange:start} and interval_start_time <= {timeRange:end}\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize interval_start_time = min(interval_start_time)\\r\\n)\\r\\n// return the earliest of these times as start of QDS range\\r\\n// if there isn't a complete QDS interval within time range, this will show the most recent available interval outside of the range\\r\\n| summarize qds_start_time = min(interval_start_time)\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "queryType": 9
                },
                {
                  "id": "ea6d3fd1-3d78-43af-99a7-f138bdece7b6",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsEndTime",
                  "type": 1,
                  "isRequired": true,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"union\\r\\n(\\r\\n// The most recent interval that is earlier than the end of time range.\\r\\n// This may be earlier than the start of time range by at most 2h.\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_end_time between (({timeRange:start} - 2h) .. {timeRange:end})\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize interval_end_time = max(interval_end_time)\\r\\n),\\r\\n(\\r\\n// latest interval end within time range\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_end_time >= {timeRange:start} and interval_start_time <= {timeRange:end}\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize interval_end_time = max(interval_end_time)\\r\\n)\\r\\n// return the latest of these times as end of QDS range\\r\\n// if there isn't a complete QDS interval within time range, this will show the latest available interval\\r\\n| summarize qds_end_time = datetime_add(\\\"second\\\", 1, max(interval_end_time)) // make-series treats the end of interval as not inclusive, fudge by 1 second\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "queryType": 9
                }
              ],
              "style": "above",
              "queryType": 9
            },
            "name": "top_query_qds_time_parameters"
          },
          {
            "type": 1,
            "content": {
              "json": "<span style=\"font-size:1.2em\">A top query is defined as a query consuming the most resources in a time interval. Resource consumption is reflected by metrics such as _execution count_, _CPU time_, _duration_, _logical reads_, etc. For each top query, choosing an aggregation type lets you see its _total_, _average_, _minimum_, or _maximum_ resource consumption within the selected time interval.</span>\r\n\r\n<span style=\"font-size:1.2em\">Query Store aggregates and stores data using fixed time intervals. Query statistics are collected and displayed for complete intervals only. Because of this, top query data may be delayed. For example, if Query Store interval length is one hour (which is the default configuration), then it will take at least one hour for the most recent query data to become available.</span>\r\n\r\nTop query data is obtained from [Query Store](https://go.microsoft.com/fwlink/?linkid=2213253), using [sys.query_store_query](https://go.microsoft.com/fwlink/?linkid=2213428), [sys.query_store_query_text](https://go.microsoft.com/fwlink/?linkid=2213154), [sys.query_store_plan](https://go.microsoft.com/fwlink/?linkid=2213251), [sys.query_store_runtime_stats](https://go.microsoft.com/fwlink/?linkid=2213252), [sys.query_store_wait_stats](https://go.microsoft.com/fwlink/?linkid=2213155), and other views."
            },
            "conditionalVisibilities": [
              {
                "parameterName": "showDescriptions",
                "comparison": "isEqualTo",
                "value": "true"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_help"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "e7bd7068-660b-41bd-894d-b6008ac6e4ca",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsAggregation",
                  "label": "Aggregation",
                  "type": 2,
                  "description": "Select the type of aggregation to use for query runtime statistics",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\":\"total\",\"label\":\"Total\"},\r\n    {\"value\":\"avg\",\"label\":\"Average\"},\r\n    {\"value\":\"max\",\"label\":\"Maximum\"},\r\n    {\"value\":\"min\",\"label\":\"Minimum\"},\r\n    {\"value\":\"stdev\",\"label\":\"Standard deviation\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "total"
                },
                {
                  "id": "d78e016e-7f9c-4ddb-be50-9cc3317387b6",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsMetric",
                  "label": "Metric",
                  "type": 2,
                  "description": "Find top queries sorting by selected metric in descending order",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\":\"count_executions\",\"label\":\"Execution count\"},\r\n    {\"value\":\"duration\",\"label\":\"Duration\"},\r\n    {\"value\":\"cpu_time\",\"label\":\"CPU time\"},\r\n    {\"value\":\"logical_io_reads\",\"label\":\"Logical reads\"},\r\n    {\"value\":\"logical_io_writes\",\"label\":\"Logical writes\"},\r\n    {\"value\":\"physical_io_reads\",\"label\":\"Physical reads (pages)\"},\r\n    {\"value\":\"num_physical_io_reads\",\"label\":\"Physical reads (IOs)\"},\r\n    {\"value\":\"dop\",\"label\":\"DOP\"},\r\n    {\"value\":\"query_max_used_memory\",\"label\":\"Memory grant\"},\r\n    {\"value\":\"rowcount\",\"label\":\"Row count\"},\r\n    {\"value\":\"log_bytes_used\",\"label\":\"Transaction log space used\"},\r\n    {\"value\":\"tempdb_space_used\",\"label\":\"Tempdb space used\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "cpu_time"
                },
                {
                  "id": "45b94f24-7a79-4941-9036-2578462ffc96",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsTopQueryCount",
                  "label": "Top query limit",
                  "type": 2,
                  "description": "The number of top queries to display",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\":5,\"label\":\"5\"},\r\n    {\"value\":10,\"label\":\"10\"},\r\n    {\"value\":25,\"label\":\"25\"},\r\n    {\"value\":50,\"label\":\"50\"},\r\n    {\"value\":100,\"label\":\"100\"},\r\n    {\"value\":200,\"label\":\"200\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "10"
                },
                {
                  "id": "a3523dda-4080-4f76-9e12-f6b835a09f56",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsExecutionType",
                  "label": "Execution types",
                  "type": 2,
                  "description": "Select one or more query execution types",
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "",
                  "delimiter": ",",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "0,1,2,3,4",
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\":\"0\",\"label\":\"Regular\"},\r\n    {\"value\":\"3\",\"label\":\"Aborted\"},\r\n    {\"value\":\"4\",\"label\":\"Exception\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "e5d2125d-9a08-4eac-b8a9-d069885a44c2",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsSelectedDatabases",
                  "label": "Databases",
                  "type": 2,
                  "description": "Select one or more databases",
                  "multiSelect": true,
                  "quote": "\"",
                  "delimiter": ",",
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| summarize dcount_server_name = dcount(server_name),\\r\\n            any_server_name = take_any(server_name)\\r\\n  by database_name\\r\\n| project database_name, server_name_agg = strcat(database_name, \\\" on \\\", iif(dcount_server_name == 1, any_server_name, strcat(any_server_name, \\\" (+\\\", tostring(dcount_server_name - 1), \\\")\\\")))\\r\\n| top 200 by tolower(database_name) asc;\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "[]",
                    "showDefault": false
                  },
                  "queryType": 9,
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "bc7a7dae-4205-422c-9c5c-97b86ad051be",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsDatabaseNameFilter",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsSelectedDatabases",
                        "operator": "is Empty",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "// no database_name filter"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsSelectedDatabases",
                        "operator": "isNotNull",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "| where database_name in ({qdsSelectedDatabases})"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "// no database_name filter"
                      }
                    }
                  ]
                },
                {
                  "id": "07f39986-d4e0-4205-b586-dc4924600e4d",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsQueryHash",
                  "label": "Query hash",
                  "type": 1,
                  "description": "Enter a query hash to show top queries with that hash. This is an optional parameter.",
                  "typeSettings": {
                    "paramValidationRules": [
                      {
                        "regExp": "\\\"",
                        "match": false,
                        "message": "Query hash filter value may not contain double quotes"
                      }
                    ]
                  },
                  "value": ""
                },
                {
                  "id": "7917da4e-962c-4ce8-8296-e6f6f22e3992",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsQueryText",
                  "label": "Query text",
                  "type": 1,
                  "description": "Enter a string to find queries with SQL text containing this string. This is an optional parameter.",
                  "typeSettings": {
                    "multiLineText": true,
                    "editorLanguage": "sql",
                    "multiLineHeight": 3
                  },
                  "value": ""
                },
                {
                  "id": "5fdd560a-69f7-4aca-9dec-7d7b239f4bd3",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsMetricLabelMidsentenceCase",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "count_executions",
                        "resultValType": "static",
                        "resultVal": "execution count"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "duration",
                        "resultValType": "static",
                        "resultVal": "duration"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "cpu_time",
                        "resultValType": "static",
                        "resultVal": "CPU time"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "logical_io_reads",
                        "resultValType": "static",
                        "resultVal": "logical reads"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "logical_io_writes",
                        "resultValType": "static",
                        "resultVal": "logical writes"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "physical_io_reads",
                        "resultValType": "static",
                        "resultVal": "physical reads (pages)"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "num_physical_io_reads",
                        "resultValType": "static",
                        "resultVal": "physical reads (IOs)"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "dop",
                        "resultValType": "static",
                        "resultVal": "DOP"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "query_max_used_memory",
                        "resultValType": "static",
                        "resultVal": "memory grant"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "rowcount",
                        "resultValType": "static",
                        "resultVal": "row count"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "log_bytes_used",
                        "resultValType": "static",
                        "resultVal": "transaction log space used"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "tempdb_space_used",
                        "resultValType": "static",
                        "resultVal": "tempdb space used"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "page_server_io_reads",
                        "resultValType": "static",
                        "resultVal": "page server reads (pages)"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "param"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "13721e52-abef-4034-95e1-f7b0a13d12b3",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsMetricUnit",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "duration",
                        "resultValType": "static",
                        "resultVal": "time"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "cpu_time",
                        "resultValType": "static",
                        "resultVal": "time"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "query_max_used_memory",
                        "resultValType": "static",
                        "resultVal": "bytes"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "log_bytes_used",
                        "resultValType": "static",
                        "resultVal": "bytes"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "qdsMetric",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "tempdb_space_used",
                        "resultValType": "static",
                        "resultVal": "bytes"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "unitless"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "cecbb02b-a14e-4650-9d82-d9487d339b38",
                  "version": "KqlParameterItem/1.0",
                  "name": "global_query_id",
                  "type": 1,
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "value": "{\"machine_name\":\"\",\"server_name\":\"\",\"database_name\":\"\",\"query_id\":0}"
                }
              ],
              "style": "pills",
              "queryType": 9
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "top_query_parameters"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "f0630d45-57bb-4eff-8761-fb757cd37f50",
                  "version": "KqlParameterItem/1.0",
                  "name": "showQueriesAs",
                  "label": "Show queries as",
                  "type": 10,
                  "description": "Show queries as tiles or as a grid",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\":\"tiles\",\"label\":\"Tiles\"},\r\n    {\"value\":\"grid\",\"label\":\"Grid\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "tiles"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "20",
            "conditionalVisibilities": [
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "show_query_as_parameters"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Query Store intervals",
              "expandable": true,
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where query_hash == iif(isnotempty(\\\"{qdsQueryHash}\\\"), \\\"{qdsQueryHash}\\\", query_hash)\\r\\n| extend interval_duration_seconds = datetime_diff(\\\"second\\\", interval_end_time, interval_start_time)\\r\\n| partition hint.strategy = shuffle by machine_name\\r\\n(\\r\\nsummarize interval_start_time = min(interval_start_time),\\r\\n          interval_end_time = max(interval_end_time),\\r\\n          avg_interval_duration = avg(interval_duration_seconds),\\r\\n          interval_count = dcount(interval_end_time)\\r\\n          by machine_name, server_name, database_id, database_name\\r\\n)\\r\\n| project machine_name, server_name, database_name, interval_start_time, interval_end_time, avg_interval_duration = iif(isnan(avg_interval_duration), real(null), avg_interval_duration), interval_count\\r\\n| sort by tolower(machine_name) asc, tolower(server_name) asc, tolower(database_name) asc\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                    "size": 1,
                    "noDataMessage": "There is no data for specified parameters.",
                    "queryType": 9,
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "interval_start_time",
                          "formatter": 6,
                          "dateFormat": {
                            "showUtcTime": null,
                            "formatName": "shortDateTimePattern"
                          },
                          "tooltipFormat": {
                            "tooltip": "The start of the first Query Store interval"
                          }
                        },
                        {
                          "columnMatch": "interval_end_time",
                          "formatter": 6,
                          "dateFormat": {
                            "showUtcTime": null,
                            "formatName": "shortDateTimePattern"
                          },
                          "tooltipFormat": {
                            "tooltip": "The end of the last Query Store interval"
                          }
                        },
                        {
                          "columnMatch": "avg_interval_duration",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal"
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Average duration of Query Store intervals. Reflects changes in interval length configuration, if any."
                          }
                        },
                        {
                          "columnMatch": "interval_count",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "The number of intervals between start and end time"
                          }
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "machine_name",
                          "label": "Machine"
                        },
                        {
                          "columnId": "server_name",
                          "label": "Server"
                        },
                        {
                          "columnId": "database_name",
                          "label": "Database"
                        },
                        {
                          "columnId": "interval_start_time",
                          "label": "Start time"
                        },
                        {
                          "columnId": "interval_end_time",
                          "label": "End time"
                        },
                        {
                          "columnId": "avg_interval_duration",
                          "label": "Interval duration"
                        },
                        {
                          "columnId": "interval_count",
                          "label": "Intervals"
                        }
                      ]
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "boundary",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": null,
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "value",
                        "formatter": 6,
                        "dateFormat": {
                          "showUtcTime": true,
                          "formatName": "shortDateTimePattern"
                        },
                        "tooltipFormat": {
                          "tooltip": "Values are shown in the local time of the database engine instance"
                        }
                      },
                      "showBorder": true,
                      "size": "auto"
                    }
                  },
                  "name": "qds_interval_range"
                }
              ]
            },
            "customWidth": "80",
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_intervals_group"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_databases = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name)),\\r\\n            dcount_query_id = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name, \\\"|\\\", query_id)),\\r\\n            query_sql_text = take_any(query_sql_text),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", avg(count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sum(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n            by query_hash\\r\\n| extend multi_query_text_warning = iif(dcount_query_id > 1, strcat(\\\"There are \\\", tostring(dcount_query_id), \\\" distinct queries in \\\", tostring(dcount_databases), \\\" databases for this query hash. Displayed query text is for one of these \\\", tostring(dcount_query_id), \\\" queries.\\\"), \\\"\\\"),\\r\\n         ranked_metric = case(\\r\\n                             \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n                             real(null)\\r\\n                             )\\r\\n| sort by count_executions desc | extend count_executions_rank = row_rank(count_executions)\\r\\n| sort by duration_us desc | extend duration_rank = row_rank(duration_us)\\r\\n| sort by cpu_time_us desc | extend cpu_time_rank = row_rank(cpu_time_us)\\r\\n| sort by logical_io_reads desc | extend logical_io_reads_rank = row_rank(logical_io_reads)\\r\\n| sort by logical_io_writes desc | extend logical_io_writes_rank = row_rank(logical_io_writes)\\r\\n| sort by physical_io_reads desc | extend physical_io_reads_rank = row_rank(physical_io_reads)\\r\\n| sort by num_physical_io_reads desc | extend num_physical_io_reads_rank = row_rank(num_physical_io_reads)\\r\\n| sort by dop desc | extend dop_rank = row_rank(dop)\\r\\n| sort by query_max_used_memory desc | extend query_max_used_memory_rank = row_rank(query_max_used_memory)\\r\\n| sort by rowcount desc | extend rowcount_rank = row_rank(rowcount)\\r\\n| sort by log_bytes_used desc | extend log_bytes_used_rank = row_rank(log_bytes_used)\\r\\n| sort by tempdb_space_used desc | extend tempdb_space_used_rank = row_rank(tempdb_space_used)\\r\\n| extend ranks = dynamic_to_json(pack_array(\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Executions\\\", \\\"Rank\\\", count_executions_rank, \\\"Value\\\", count_executions),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Duration\\\", \\\"Rank\\\", duration_rank, \\\"Value\\\", duration_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CPU time\\\", \\\"Rank\\\", cpu_time_rank, \\\"Value\\\", cpu_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical reads\\\", \\\"Rank\\\", logical_io_reads_rank, \\\"Value\\\", logical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical writes\\\", \\\"Rank\\\", logical_io_writes_rank, \\\"Value\\\", logical_io_writes),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (pages)\\\", \\\"Rank\\\", physical_io_reads_rank, \\\"Value\\\", physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (IOs)\\\", \\\"Rank\\\", num_physical_io_reads_rank, \\\"Value\\\", num_physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"DOP\\\", \\\"Rank\\\", dop_rank, \\\"Value\\\", dop),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Memory grant\\\", \\\"Rank\\\", query_max_used_memory_rank, \\\"Value\\\", query_max_used_memory),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Row count\\\", \\\"Rank\\\", rowcount_rank, \\\"Value\\\", rowcount),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Transaction log space used\\\", \\\"Rank\\\", log_bytes_used_rank, \\\"Value\\\", log_bytes_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Tempdb space used\\\", \\\"Rank\\\", tempdb_space_used_rank, \\\"Value\\\", tempdb_space_used)\\r\\n                                           ))\\r\\n| project-away count_executions_rank, duration_rank, cpu_time_rank, logical_io_reads_rank, logical_io_writes_rank, physical_io_reads_rank, num_physical_io_reads_rank, dop_rank, query_max_used_memory_rank, rowcount_rank, log_bytes_used_rank, tempdb_space_used_rank\\r\\n| sort by ranked_metric desc\\r\\n| extend rank = row_rank(ranked_metric)\\r\\n| project query_hash,\\r\\n          rank,\\r\\n          ranked_metric,\\r\\n          count_executions,\\r\\n          query_sql_text,\\r\\n          query_sql_text_json = dynamic_to_json(pack(\\\"query_sql_text\\\", query_sql_text)),\\r\\n          multi_query_text_warning,\\r\\n          tile_label = strcat(\\\"Query hash: \\\", tostring(query_hash)),\\r\\n          ranks\\r\\n// Restrict by query_hash after ranking to preserve query rank value in results\\r\\n| where query_hash == iif(isnotempty(@\\\"{qdsQueryHash}\\\"), @\\\"{qdsQueryHash}\\\", query_hash)\\r\\n| where query_sql_text contains \\\"{qdsQueryText:escape}\\\"\\r\\n| sort by rank asc, count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n| take {qdsTopQueryCount}\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "title": "Top queries ranked by {qdsAggregation} {qdsMetricLabelMidsentenceCase}",
              "noDataMessage": "There is no data for specified parameters.",
              "exportedParameters": [
                {
                  "fieldName": "query_sql_text_json",
                  "parameterName": "query_sql_text_json",
                  "defaultValue": "\"<Select a query>\""
                },
                {
                  "fieldName": "query_hash",
                  "parameterName": "query_hash",
                  "parameterType": 1,
                  "defaultValue": "\"\""
                },
                {
                  "fieldName": "multi_query_text_warning",
                  "parameterName": "multi_query_text_warning",
                  "parameterType": 1,
                  "defaultValue": "\"\""
                },
                {
                  "fieldName": "ranks",
                  "parameterName": "ranks",
                  "parameterType": 1
                }
              ],
              "queryType": 9,
              "visualization": "tiles",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_executions",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "count_successful_executions",
                            "color": "green"
                          },
                          {
                            "columnName": "count_aborted_executions",
                            "color": "orange"
                          },
                          {
                            "columnName": "count_exception_executions",
                            "color": "red"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                    }
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "formatter": 1
                },
                "subtitleContent": {
                  "columnMatch": "database_name"
                },
                "leftContent": {
                  "columnMatch": "rank",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "rightContent": {
                  "columnMatch": "ranked_metric",
                  "formatter": 4,
                  "formatOptions": {
                    "palette": "coldHot"
                  },
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "tile_label",
                  "formatter": 1
                },
                "showBorder": true,
                "sortCriteriaField": "rank",
                "sortOrderField": 1,
                "size": "auto"
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isEqualTo",
                "value": "tiles"
              },
              {
                "parameterName": "qdsMetricUnit",
                "comparison": "isEqualTo",
                "value": "unitless"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_top_queries_tiles_unitless"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_databases = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name)),\\r\\n            dcount_query_id = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name, \\\"|\\\", query_id)),\\r\\n            query_sql_text = take_any(query_sql_text),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", avg(count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sum(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n            by query_hash\\r\\n| extend multi_query_text_warning = iif(dcount_query_id > 1, strcat(\\\"There are \\\", tostring(dcount_query_id), \\\" distinct queries in \\\", tostring(dcount_databases), \\\" databases for this query hash. Displayed query text is for one of these \\\", tostring(dcount_query_id), \\\" queries.\\\"), \\\"\\\"),\\r\\n         ranked_metric = case(\\r\\n                             \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n                             real(null)\\r\\n                             )\\r\\n| sort by count_executions desc | extend count_executions_rank = row_rank(count_executions)\\r\\n| sort by duration_us desc | extend duration_rank = row_rank(duration_us)\\r\\n| sort by cpu_time_us desc | extend cpu_time_rank = row_rank(cpu_time_us)\\r\\n| sort by logical_io_reads desc | extend logical_io_reads_rank = row_rank(logical_io_reads)\\r\\n| sort by logical_io_writes desc | extend logical_io_writes_rank = row_rank(logical_io_writes)\\r\\n| sort by physical_io_reads desc | extend physical_io_reads_rank = row_rank(physical_io_reads)\\r\\n| sort by num_physical_io_reads desc | extend num_physical_io_reads_rank = row_rank(num_physical_io_reads)\\r\\n| sort by dop desc | extend dop_rank = row_rank(dop)\\r\\n| sort by query_max_used_memory desc | extend query_max_used_memory_rank = row_rank(query_max_used_memory)\\r\\n| sort by rowcount desc | extend rowcount_rank = row_rank(rowcount)\\r\\n| sort by log_bytes_used desc | extend log_bytes_used_rank = row_rank(log_bytes_used)\\r\\n| sort by tempdb_space_used desc | extend tempdb_space_used_rank = row_rank(tempdb_space_used)\\r\\n| extend ranks = dynamic_to_json(pack_array(\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Executions\\\", \\\"Rank\\\", count_executions_rank, \\\"Value\\\", count_executions),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Duration\\\", \\\"Rank\\\", duration_rank, \\\"Value\\\", duration_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CPU time\\\", \\\"Rank\\\", cpu_time_rank, \\\"Value\\\", cpu_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical reads\\\", \\\"Rank\\\", logical_io_reads_rank, \\\"Value\\\", logical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical writes\\\", \\\"Rank\\\", logical_io_writes_rank, \\\"Value\\\", logical_io_writes),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (pages)\\\", \\\"Rank\\\", physical_io_reads_rank, \\\"Value\\\", physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (IOs)\\\", \\\"Rank\\\", num_physical_io_reads_rank, \\\"Value\\\", num_physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"DOP\\\", \\\"Rank\\\", dop_rank, \\\"Value\\\", dop),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Memory grant\\\", \\\"Rank\\\", query_max_used_memory_rank, \\\"Value\\\", query_max_used_memory),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Row count\\\", \\\"Rank\\\", rowcount_rank, \\\"Value\\\", rowcount),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Transaction log space used\\\", \\\"Rank\\\", log_bytes_used_rank, \\\"Value\\\", log_bytes_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Tempdb space used\\\", \\\"Rank\\\", tempdb_space_used_rank, \\\"Value\\\", tempdb_space_used)\\r\\n                                           ))\\r\\n| project-away count_executions_rank, duration_rank, cpu_time_rank, logical_io_reads_rank, logical_io_writes_rank, physical_io_reads_rank, num_physical_io_reads_rank, dop_rank, query_max_used_memory_rank, rowcount_rank, log_bytes_used_rank, tempdb_space_used_rank\\r\\n| sort by ranked_metric desc\\r\\n| extend rank = row_rank(ranked_metric)\\r\\n| project query_hash,\\r\\n          rank,\\r\\n          ranked_metric,\\r\\n          count_executions,\\r\\n          query_sql_text,\\r\\n          query_sql_text_json = dynamic_to_json(pack(\\\"query_sql_text\\\", query_sql_text)),\\r\\n          multi_query_text_warning,\\r\\n          tile_label = strcat(\\\"Query hash: \\\", tostring(query_hash)),\\r\\n          ranks\\r\\n// Restrict by query_id/query_hash after ranking to preserve query rank value in results\\r\\n| where query_hash == iif(isnotempty(@\\\"{qdsQueryHash}\\\"), @\\\"{qdsQueryHash}\\\", query_hash)\\r\\n| where query_sql_text contains \\\"{qdsQueryText:escape}\\\"\\r\\n| sort by rank asc, count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n| take {qdsTopQueryCount}\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "title": "Top queries ranked by {qdsAggregation} {qdsMetricLabelMidsentenceCase}",
              "noDataMessage": "There is no data for specified parameters.",
              "exportedParameters": [
                {
                  "fieldName": "query_sql_text_json",
                  "parameterName": "query_sql_text_json",
                  "defaultValue": "\"<Select a query>\""
                },
                {
                  "fieldName": "query_hash",
                  "parameterName": "query_hash",
                  "parameterType": 1,
                  "defaultValue": "\"\""
                },
                {
                  "fieldName": "multi_query_text_warning",
                  "parameterName": "multi_query_text_warning",
                  "parameterType": 1
                },
                {
                  "fieldName": "ranks",
                  "parameterName": "ranks",
                  "parameterType": 1
                }
              ],
              "queryType": 9,
              "visualization": "tiles",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_executions",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "count_successful_executions",
                            "color": "green"
                          },
                          {
                            "columnName": "count_aborted_executions",
                            "color": "orange"
                          },
                          {
                            "columnName": "count_exception_executions",
                            "color": "red"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                    }
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "formatter": 1
                },
                "subtitleContent": {
                  "columnMatch": "database_name"
                },
                "leftContent": {
                  "columnMatch": "rank",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "rightContent": {
                  "columnMatch": "ranked_metric",
                  "formatter": 4,
                  "formatOptions": {
                    "palette": "coldHot"
                  },
                  "numberFormat": {
                    "unit": 22,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "tile_label",
                  "formatter": 1
                },
                "showBorder": true,
                "sortCriteriaField": "rank",
                "sortOrderField": 1,
                "size": "auto"
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isEqualTo",
                "value": "tiles"
              },
              {
                "parameterName": "qdsMetricUnit",
                "comparison": "isEqualTo",
                "value": "time"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_top_queries_tiles_time"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_databases = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name)),\\r\\n            dcount_query_id = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name, \\\"|\\\", query_id)),\\r\\n            query_sql_text = take_any(query_sql_text),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", avg(count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sum(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n            by query_hash\\r\\n| extend multi_query_text_warning = iif(dcount_query_id > 1, strcat(\\\"There are \\\", tostring(dcount_query_id), \\\" distinct queries in \\\", tostring(dcount_databases), \\\" databases for this query hash. Displayed query text is for one of these \\\", tostring(dcount_query_id), \\\" queries.\\\"), \\\"\\\"),\\r\\n         ranked_metric = case(\\r\\n                             \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory * 8 * 1024),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used * 8 * 1024),\\r\\n                             real(null)\\r\\n                             )\\r\\n| sort by count_executions desc | extend count_executions_rank = row_rank(count_executions)\\r\\n| sort by duration_us desc | extend duration_rank = row_rank(duration_us)\\r\\n| sort by cpu_time_us desc | extend cpu_time_rank = row_rank(cpu_time_us)\\r\\n| sort by logical_io_reads desc | extend logical_io_reads_rank = row_rank(logical_io_reads)\\r\\n| sort by logical_io_writes desc | extend logical_io_writes_rank = row_rank(logical_io_writes)\\r\\n| sort by physical_io_reads desc | extend physical_io_reads_rank = row_rank(physical_io_reads)\\r\\n| sort by num_physical_io_reads desc | extend num_physical_io_reads_rank = row_rank(num_physical_io_reads)\\r\\n| sort by dop desc | extend dop_rank = row_rank(dop)\\r\\n| sort by query_max_used_memory desc | extend query_max_used_memory_rank = row_rank(query_max_used_memory)\\r\\n| sort by rowcount desc | extend rowcount_rank = row_rank(rowcount)\\r\\n| sort by log_bytes_used desc | extend log_bytes_used_rank = row_rank(log_bytes_used)\\r\\n| sort by tempdb_space_used desc | extend tempdb_space_used_rank = row_rank(tempdb_space_used)\\r\\n| extend ranks = dynamic_to_json(pack_array(\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Executions\\\", \\\"Rank\\\", count_executions_rank, \\\"Value\\\", count_executions),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Duration\\\", \\\"Rank\\\", duration_rank, \\\"Value\\\", duration_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CPU time\\\", \\\"Rank\\\", cpu_time_rank, \\\"Value\\\", cpu_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical reads\\\", \\\"Rank\\\", logical_io_reads_rank, \\\"Value\\\", logical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical writes\\\", \\\"Rank\\\", logical_io_writes_rank, \\\"Value\\\", logical_io_writes),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (pages)\\\", \\\"Rank\\\", physical_io_reads_rank, \\\"Value\\\", physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (IOs)\\\", \\\"Rank\\\", num_physical_io_reads_rank, \\\"Value\\\", num_physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"DOP\\\", \\\"Rank\\\", dop_rank, \\\"Value\\\", dop),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Memory grant\\\", \\\"Rank\\\", query_max_used_memory_rank, \\\"Value\\\", query_max_used_memory),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Row count\\\", \\\"Rank\\\", rowcount_rank, \\\"Value\\\", rowcount),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Transaction log space used\\\", \\\"Rank\\\", log_bytes_used_rank, \\\"Value\\\", log_bytes_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Tempdb space used\\\", \\\"Rank\\\", tempdb_space_used_rank, \\\"Value\\\", tempdb_space_used)\\r\\n                                           ))\\r\\n| project-away count_executions_rank, duration_rank, cpu_time_rank, logical_io_reads_rank, logical_io_writes_rank, physical_io_reads_rank, num_physical_io_reads_rank, dop_rank, query_max_used_memory_rank, rowcount_rank, log_bytes_used_rank, tempdb_space_used_rank\\r\\n| sort by ranked_metric desc\\r\\n| extend rank = row_rank(ranked_metric)\\r\\n| project query_hash,\\r\\n          rank,\\r\\n          ranked_metric,\\r\\n          count_executions,\\r\\n          query_sql_text,\\r\\n          query_sql_text_json = dynamic_to_json(pack(\\\"query_sql_text\\\", query_sql_text)),\\r\\n          multi_query_text_warning,\\r\\n          tile_label = strcat(\\\"Query hash: \\\", tostring(query_hash)),\\r\\n          ranks\\r\\n// Restrict by query_id/query_hash after ranking to preserve query rank value in results\\r\\n| where query_hash == iif(isnotempty(@\\\"{qdsQueryHash}\\\"), @\\\"{qdsQueryHash}\\\", query_hash)\\r\\n| where query_sql_text contains \\\"{qdsQueryText:escape}\\\"\\r\\n| sort by rank asc, count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n| take {qdsTopQueryCount}\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "title": "Top queries ranked by {qdsAggregation} {qdsMetricLabelMidsentenceCase}",
              "noDataMessage": "There is no data for specified parameters.",
              "exportedParameters": [
                {
                  "fieldName": "query_sql_text_json",
                  "parameterName": "query_sql_text_json",
                  "defaultValue": "\"<Select a query>\""
                },
                {
                  "fieldName": "query_hash",
                  "parameterName": "query_hash",
                  "parameterType": 1,
                  "defaultValue": "\"\""
                },
                {
                  "fieldName": "multi_query_text_warning",
                  "parameterName": "multi_query_text_warning",
                  "parameterType": 1
                },
                {
                  "fieldName": "ranks",
                  "parameterName": "ranks",
                  "parameterType": 1
                }
              ],
              "queryType": 9,
              "visualization": "tiles",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_executions",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "count_successful_executions",
                            "color": "green"
                          },
                          {
                            "columnName": "count_aborted_executions",
                            "color": "orange"
                          },
                          {
                            "columnName": "count_exception_executions",
                            "color": "red"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                    }
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "formatter": 1
                },
                "subtitleContent": {
                  "columnMatch": "database_name"
                },
                "leftContent": {
                  "columnMatch": "rank",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "rightContent": {
                  "columnMatch": "ranked_metric",
                  "formatter": 4,
                  "formatOptions": {
                    "palette": "coldHot"
                  },
                  "numberFormat": {
                    "unit": 2,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "Query runtime statistic"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "tile_label",
                  "formatter": 1
                },
                "showBorder": true,
                "sortCriteriaField": "rank",
                "sortOrderField": 1,
                "size": "auto"
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isEqualTo",
                "value": "tiles"
              },
              {
                "parameterName": "qdsMetricUnit",
                "comparison": "isEqualTo",
                "value": "bytes"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_top_queries_tiles_bytes"
          },
          {
            "type": 1,
            "content": {
              "json": "<span style=\"font-size:1.2em\">Each tile represents all queries with the same query hash. The large number on the tile is **query rank** by `{qdsAggregation} {qdsMetricLabelMidsentenceCase}`. Two queries have the same rank if their resource usage during the interval is the same.</span>\r\n\r\n<span style=\"font-size:1.2em\">The tile also shows `{qdsAggregation} {qdsMetricLabelMidsentenceCase}` value, aggregated over selected time range. The length of the bar below this value is proportional to resource usage by this query, compared to other top queries displayed.</span>\r\n\r\n<span style=\"font-size:1.2em\">The `Query hash` value is displayed at the bottom of each tile. You can copy it and paste it in the `Query hash` parameter box above to focus on a specific top query.</span>"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "showDescriptions",
                "comparison": "isEqualTo",
                "value": "true"
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isEqualTo",
                "value": "tiles"
              },
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_tiles_help"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_databases = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name)),\\r\\n            any_database_name = take_any(database_name),\\r\\n            dcount_query_id = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name, \\\"|\\\", query_id)),\\r\\n            dcount_sql_module_name = dcount(sql_module_name),\\r\\n            any_sql_module_name = take_any(sql_module_name),\\r\\n            dcount_context_settings_id = dcount(context_settings_id),\\r\\n            any_context_settings_id = take_any(context_settings_id),\\r\\n            dcount_plan_id = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name, \\\"|\\\", plan_id)),\\r\\n            query_sql_text = take_any(query_sql_text),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", round(avg(count_executions), 2),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sum(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            count_successful_executions = case(\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", round(avgif(count_executions, execution_type_desc == \\\"Regular\\\"), 2),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", minif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sumif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              real(null)\\r\\n                                              ),\\r\\n            count_aborted_executions = case(\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", round(avgif(count_executions, execution_type_desc == \\\"Aborted\\\"), 2),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", minif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sumif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           real(null)\\r\\n                                           ),\\r\\n            count_exception_executions = case(\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", round(avgif(count_executions, execution_type_desc == \\\"Exception\\\"), 2),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", minif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sumif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             real(null)\\r\\n                                             ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n            by query_hash\\r\\n| extend multi_query_text_warning = iif(dcount_query_id > 1, strcat(\\\"There are \\\", tostring(dcount_query_id), \\\" distinct queries in \\\", tostring(dcount_databases), \\\" databases for this query hash. Displayed query text is for one of these \\\", tostring(dcount_query_id), \\\" queries.\\\"), \\\"\\\")\\r\\n| project query_hash,\\r\\n          database_name_agg = iif(dcount_databases == 1, any_database_name, strcat(any_database_name, \\\" (+\\\", tostring(dcount_databases - 1), \\\")\\\")),\\r\\n          count_executions,\\r\\n          count_successful_executions,\\r\\n          count_aborted_executions,\\r\\n          count_exception_executions,\\r\\n          duration_us,\\r\\n          cpu_time_us,\\r\\n          logical_io_reads,\\r\\n          logical_io_writes,\\r\\n          physical_io_reads,\\r\\n          num_physical_io_reads,\\r\\n          dop,\\r\\n          query_max_used_memory_kb = query_max_used_memory * 8,\\r\\n          rowcount,\\r\\n          log_bytes_used,\\r\\n          tempdb_space_used_kb = tempdb_space_used * 8,\\r\\n          sql_module_name_agg = iif(dcount_sql_module_name == 1, any_sql_module_name, strcat(any_sql_module_name, \\\" (+\\\", tostring(dcount_sql_module_name - 1), \\\")\\\")),\\r\\n          context_settings_id_agg = iif(dcount_context_settings_id == 1, tostring(any_context_settings_id), strcat(any_context_settings_id, \\\" (+\\\", tostring(dcount_context_settings_id - 1), \\\")\\\")),\\r\\n          query_sql_text,\\r\\n          query_sql_text_json = dynamic_to_json(pack(\\\"query_sql_text\\\", query_sql_text)),\\r\\n          multi_query_text_warning\\r\\n| sort by count_executions desc | extend count_executions_rank = row_rank(count_executions)\\r\\n| sort by duration_us desc | extend duration_rank = row_rank(duration_us)\\r\\n| sort by cpu_time_us desc | extend cpu_time_rank = row_rank(cpu_time_us)\\r\\n| sort by logical_io_reads desc | extend logical_io_reads_rank = row_rank(logical_io_reads)\\r\\n| sort by logical_io_writes desc | extend logical_io_writes_rank = row_rank(logical_io_writes)\\r\\n| sort by physical_io_reads desc | extend physical_io_reads_rank = row_rank(physical_io_reads)\\r\\n| sort by num_physical_io_reads desc | extend num_physical_io_reads_rank = row_rank(num_physical_io_reads)\\r\\n| sort by dop desc | extend dop_rank = row_rank(dop)\\r\\n| sort by query_max_used_memory_kb desc | extend query_max_used_memory_rank = row_rank(query_max_used_memory_kb)\\r\\n| sort by rowcount desc | extend rowcount_rank = row_rank(rowcount)\\r\\n| sort by log_bytes_used desc | extend log_bytes_used_rank = row_rank(log_bytes_used)\\r\\n| sort by tempdb_space_used_kb desc | extend tempdb_space_used_rank = row_rank(tempdb_space_used_kb)\\r\\n| extend ranks = dynamic_to_json(pack_array(\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Executions\\\", \\\"Rank\\\", count_executions_rank, \\\"Value\\\", count_executions),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Duration\\\", \\\"Rank\\\", duration_rank, \\\"Value\\\", duration_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CPU time\\\", \\\"Rank\\\", cpu_time_rank, \\\"Value\\\", cpu_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical reads\\\", \\\"Rank\\\", logical_io_reads_rank, \\\"Value\\\", logical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical writes\\\", \\\"Rank\\\", logical_io_writes_rank, \\\"Value\\\", logical_io_writes),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (pages)\\\", \\\"Rank\\\", physical_io_reads_rank, \\\"Value\\\", physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (IOs)\\\", \\\"Rank\\\", num_physical_io_reads_rank, \\\"Value\\\", num_physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"DOP\\\", \\\"Rank\\\", dop_rank, \\\"Value\\\", dop),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Memory grant\\\", \\\"Rank\\\", query_max_used_memory_rank, \\\"Value\\\", query_max_used_memory_kb),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Row count\\\", \\\"Rank\\\", rowcount_rank, \\\"Value\\\", rowcount),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Transaction log space used\\\", \\\"Rank\\\", log_bytes_used_rank, \\\"Value\\\", log_bytes_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Tempdb space used\\\", \\\"Rank\\\", tempdb_space_used_rank, \\\"Value\\\", tempdb_space_used_kb)\\r\\n                                           ))\\r\\n| project-away count_executions_rank, duration_rank, cpu_time_rank, logical_io_reads_rank, logical_io_writes_rank, physical_io_reads_rank, num_physical_io_reads_rank, dop_rank, query_max_used_memory_rank, rowcount_rank, log_bytes_used_rank, tempdb_space_used_rank\\r\\n| sort by case(\\r\\n              \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n              \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n              \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n              \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory_kb),\\r\\n              \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n              \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n              \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used_kb),\\r\\n              real(null)\\r\\n              ) desc,\\r\\n          count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n// Restrict by query_id/query_hash after ranking to preserve query rank value in results\\r\\n| where query_hash == iif(isnotempty(@\\\"{qdsQueryHash}\\\"), @\\\"{qdsQueryHash}\\\", query_hash)\\r\\n| where query_sql_text contains \\\"{qdsQueryText:escape}\\\"\\r\\n| take {qdsTopQueryCount}\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 0,
              "showAnalytics": true,
              "title": "Top queries by {qdsAggregation} {qdsMetricLabelMidsentenceCase}",
              "noDataMessage": "There is no data for specified parameters.",
              "exportedParameters": [
                {
                  "fieldName": "query_sql_text_json",
                  "parameterName": "query_sql_text_json",
                  "defaultValue": "\"<Select a query>\""
                },
                {
                  "fieldName": "q_id",
                  "parameterName": "query_id",
                  "parameterType": 1,
                  "defaultValue": "0"
                },
                {
                  "fieldName": "query_hash",
                  "parameterName": "query_hash",
                  "parameterType": 1,
                  "defaultValue": "\"\""
                },
                {
                  "fieldName": "multi_query_text_warning",
                  "parameterName": "multi_query_text_warning",
                  "parameterType": 1
                },
                {
                  "fieldName": "ranks",
                  "parameterName": "ranks",
                  "parameterType": 1
                },
                {
                  "fieldName": "database_id",
                  "parameterName": "database_id",
                  "parameterType": 1,
                  "defaultValue": "0"
                }
              ],
              "showExportToExcel": true,
              "queryType": 9,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_executions",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "count_successful_executions",
                            "color": "green"
                          },
                          {
                            "columnName": "count_aborted_executions",
                            "color": "orange"
                          },
                          {
                            "columnName": "count_exception_executions",
                            "color": "red"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                    }
                  },
                  {
                    "columnMatch": "count_successful_executions",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "count_aborted_executions",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "count_exception_executions",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "duration_us",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 22,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "cpu_time_us",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 22,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "logical_io_reads",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "logical_io_writes",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "physical_io_reads",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "24ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "num_physical_io_reads",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "24ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "dop",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "query_max_used_memory_kb",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 3,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "rowcount",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "log_bytes_used",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "tempdb_space_used_kb",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 3,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "query_sql_text",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "query_sql_text_json",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "multi_query_text_warning",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ranks",
                    "formatter": 5
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "query_hash",
                    "label": "Query hash"
                  },
                  {
                    "columnId": "database_name_agg",
                    "label": "Database"
                  },
                  {
                    "columnId": "count_executions",
                    "label": "Executions"
                  },
                  {
                    "columnId": "duration_us",
                    "label": "Duration"
                  },
                  {
                    "columnId": "cpu_time_us",
                    "label": "CPU time"
                  },
                  {
                    "columnId": "logical_io_reads",
                    "label": "Logical reads"
                  },
                  {
                    "columnId": "logical_io_writes",
                    "label": "Logical writes"
                  },
                  {
                    "columnId": "physical_io_reads",
                    "label": "Physical reads (pages)"
                  },
                  {
                    "columnId": "num_physical_io_reads",
                    "label": "Physical reads (IOs)"
                  },
                  {
                    "columnId": "dop",
                    "label": "DOP"
                  },
                  {
                    "columnId": "query_max_used_memory_kb",
                    "label": "Memory grant"
                  },
                  {
                    "columnId": "rowcount",
                    "label": "Rows"
                  },
                  {
                    "columnId": "log_bytes_used",
                    "label": "Log space"
                  },
                  {
                    "columnId": "tempdb_space_used_kb",
                    "label": "Tempdb space"
                  },
                  {
                    "columnId": "sql_module_name_agg",
                    "label": "SQL module"
                  },
                  {
                    "columnId": "context_settings_id_agg",
                    "label": "Context settings ID"
                  }
                ]
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isEqualTo",
                "value": "grid"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_top_queries_grid"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "ef3541b2-fdd5-4705-8689-b9ce167c1767",
                  "version": "KqlParameterItem/1.0",
                  "name": "qdsAnyWaits",
                  "type": 1,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_wait_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| count\\r\\n| project Count = tostring(Count)\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 9
                }
              ],
              "style": "pills",
              "queryType": 9
            },
            "conditionalVisibility": {
              "parameterName": "sqlserver_query_wait_stats",
              "comparison": "isEqualTo",
              "value": "1"
            },
            "name": "qds_waits_existence_parameters"
          },
          {
            "type": 1,
            "content": {
              "json": "{multi_query_text_warning}",
              "style": "warning"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "multi_query_text_warning",
                "comparison": "isNotEqualTo",
                "value": ""
              },
              {
                "parameterName": "multi_query_text_warning",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              }
            ],
            "name": "multi_query_text_warning"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"datatable(ranks:dynamic)[dynamic({ranks})]\\r\\n| mv-expand bagexpansion=array ranks\\r\\n| mv-expand metric = ranks.Metric to typeof(string), rank = ranks.Rank to typeof(int), value = ranks.Value to typeof(real)\\r\\n| where value > 0 // Do not include high ranks if usage is zero\\r\\n| where not (metric==\\\"DOP\\\" and value==1 or metric==\\\"Executions\\\" and value==1 or metric==\\\"Rows\\\" and value==1) // Do not consider trivial usage\\r\\n| project r=rank, metric, rank\\r\\n| sort by rank asc, metric asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 1,
              "title": "Query ranks",
              "noDataMessage": "Selected query is not ranked high by any metric",
              "queryType": 9,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "r",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "<=",
                          "thresholdValue": "1",
                          "representation": "Sev0",
                          "text": "[\"metric\"]"
                        },
                        {
                          "operator": "<=",
                          "thresholdValue": "3",
                          "representation": "Sev1",
                          "text": "[\"metric\"]"
                        },
                        {
                          "operator": "<=",
                          "thresholdValue": "10",
                          "representation": "Sev2",
                          "text": "[\"metric\"]"
                        },
                        {
                          "operator": "<=",
                          "thresholdValue": "20",
                          "representation": "Sev3",
                          "text": "[\"metric\"]"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev4",
                          "text": "[\"metric\"]"
                        }
                      ],
                      "customColumnWidthSetting": "27ch"
                    }
                  },
                  {
                    "columnMatch": "metric",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "rank",
                    "formatter": 0,
                    "tooltipFormat": {
                      "tooltip": "Lower numbers mean higher ranks, i.e. higher resource consumption for this metric"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "r",
                    "label": "Metric"
                  },
                  {
                    "columnId": "rank",
                    "label": "Rank"
                  }
                ]
              },
              "sortBy": [],
              "tileSettings": {
                "titleContent": {
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "rank",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "hotCold"
                  },
                  "tooltipFormat": {
                    "tooltip": "Rank 1 by \"CPU time\" means that the query is the top consumer of CPU, compared to other queries in the same time interval. The metrics ranked in the 1-10 range, if any for this query, are shown."
                  }
                },
                "rightContent": {
                  "columnMatch": "metric",
                  "formatter": 1
                },
                "showBorder": true,
                "sortCriteriaField": "rank",
                "sortOrderField": 1,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "ranks",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "top_query_ranks"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_wait_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| summarize query_wait_time_ms = case(\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(toreal(total_query_wait_time_ms)),\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_wait_time_ms),\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_wait_time_ms)),\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_wait_time_ms)),\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_wait_time_ms), // use maximum stdev for the interval\\r\\n                                     real(null)\\r\\n                                     )\\r\\n            by wait_category_desc\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 1,
              "title": "Query wait categories",
              "noDataMessage": "There is no data for specified parameters.",
              "queryType": 9,
              "visualization": "barchart",
              "chartSettings": {
                "yAxis": [
                  "query_wait_time_ms"
                ],
                "showMetrics": false,
                "seriesLabelSettings": [
                  {
                    "seriesName": "Unknown",
                    "color": "gray"
                  },
                  {
                    "seriesName": "CPU",
                    "color": "magenta"
                  },
                  {
                    "seriesName": "Worker Thread",
                    "color": "brown"
                  },
                  {
                    "seriesName": "Lock",
                    "color": "redBright"
                  },
                  {
                    "seriesName": "Latch",
                    "color": "blueDark"
                  },
                  {
                    "seriesName": "Buffer Latch",
                    "color": "purple"
                  },
                  {
                    "seriesName": "Buffer IO",
                    "color": "lightBlue"
                  },
                  {
                    "seriesName": "Tran Log IO",
                    "color": "green"
                  },
                  {
                    "seriesName": "Network IO",
                    "color": "greenDark"
                  },
                  {
                    "seriesName": "Parallelism",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Memory",
                    "color": "turquoise"
                  },
                  {
                    "seriesName": "Other Disk IO",
                    "color": "grayBlue"
                  },
                  {
                    "seriesName": "Replication",
                    "color": "pink"
                  },
                  {
                    "seriesName": "Log Rate Governor",
                    "color": "red"
                  }
                ],
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 23,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "25",
            "conditionalVisibilities": [
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "sqlserver_query_wait_stats",
                "comparison": "isEqualTo",
                "value": "1"
              },
              {
                "parameterName": "qdsAnyWaits",
                "comparison": "isNotEqualTo",
                "value": "0"
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_query_wait_categories"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"{query_sql_text_json}\",\"transformers\":null}",
              "size": 1,
              "title": "Query SQL text",
              "noDataMessage": "Unknown",
              "queryType": 8,
              "visualization": "card",
              "textSettings": {
                "style": "editor"
              }
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "query_sql_text"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Selected top query in individual databases",
              "expandable": true,
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| summarize dcount_sql_module_name = dcount(sql_module_name),\\r\\n            any_sql_module_name = take_any(sql_module_name),\\r\\n            dcount_context_settings_id = dcount(context_settings_id),\\r\\n            any_context_settings_id = take_any(context_settings_id),\\r\\n            dcount_plan_id = dcount(plan_id),\\r\\n            any_plan_id = take_any(plan_id),\\r\\n            dcount_query_plan_hash = dcount(query_plan_hash),\\r\\n            any_query_plan_hash = take_any(query_plan_hash),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", round(avg(count_executions), 2),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            count_successful_executions = case(\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", round(avgif(count_executions, execution_type_desc == \\\"Regular\\\"), 2),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"min\\\", minif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"max\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              real(null)\\r\\n                                              ),\\r\\n            count_aborted_executions = case(\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", round(avgif(count_executions, execution_type_desc == \\\"Aborted\\\"), 2),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"min\\\", minif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"max\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           real(null)\\r\\n                                           ),\\r\\n            count_exception_executions = case(\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"avg\\\", round(avgif(count_executions, execution_type_desc == \\\"Exception\\\"), 2),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"min\\\", minif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"max\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"stdev\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             real(null)\\r\\n                                             ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n            by machine_name, server_name, database_name, query_id\\r\\n| project machine_name,\\r\\n          server_name,\\r\\n          database_name,\\r\\n          query_id,\\r\\n          query_plan_hash_agg = iif(dcount_query_plan_hash == 1, any_query_plan_hash, strcat(any_query_plan_hash, \\\" (+\\\", tostring(dcount_query_plan_hash - 1), \\\")\\\")),\\r\\n          plan_id_agg = iif(dcount_plan_id == 1, tostring(any_plan_id), strcat(any_plan_id, \\\" (+\\\", tostring(dcount_plan_id - 1), \\\")\\\")),\\r\\n          count_executions,\\r\\n          count_successful_executions,\\r\\n          count_aborted_executions,\\r\\n          count_exception_executions,\\r\\n          duration_us,\\r\\n          cpu_time_us,\\r\\n          logical_io_reads,\\r\\n          logical_io_writes,\\r\\n          physical_io_reads,\\r\\n          num_physical_io_reads,\\r\\n          dop,\\r\\n          query_max_used_memory_kb = query_max_used_memory * 8,\\r\\n          rowcount,\\r\\n          log_bytes_used,\\r\\n          tempdb_space_used_kb = tempdb_space_used * 8,\\r\\n          sql_module_name_agg = iif(dcount_sql_module_name == 1, any_sql_module_name, strcat(any_sql_module_name, \\\" (+\\\", tostring(dcount_sql_module_name - 1), \\\")\\\")),\\r\\n          context_settings_id_agg = iif(dcount_context_settings_id == 1, tostring(any_context_settings_id), strcat(any_context_settings_id, \\\" (+\\\", tostring(dcount_context_settings_id - 1), \\\")\\\")),\\r\\n          global_query_id = dynamic_to_json(bag_pack(\\\"machine_name\\\", machine_name, \\\"server_name\\\", server_name, \\\"database_name\\\", database_name, \\\"query_id\\\", query_id))\\r\\n| sort by case(\\r\\n              \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n              \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n              \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n              \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory_kb),\\r\\n              \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n              \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n              \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used_kb),\\r\\n              real(null)\\r\\n              ) desc,\\r\\n          count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                    "size": 1,
                    "showAnalytics": true,
                    "noDataMessage": "There is no data for specified parameters.",
                    "exportFieldName": "global_query_id",
                    "exportParameterName": "global_query_id",
                    "exportDefaultValue": "{\"machine_name\":\"\",\"server_name\":\"\",\"database_name\":\"\",\"query_id\":0}",
                    "showExportToExcel": true,
                    "queryType": 9,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "server_name",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "WorkbookTemplate",
                            "workbookContext": {
                              "componentIdSource": "workbook",
                              "resourceIdsSource": "workbook",
                              "templateIdSource": "static",
                              "templateId": "Community-Workbooks/Database watcher/SQL Server/instance",
                              "typeSource": "workbook",
                              "gallerySource": "default",
                              "locationSource": "workbook",
                              "workbookName": "SQL Server instance",
                              "passSpecificParams": true,
                              "templateParameters": [
                                {
                                  "name": "machineName",
                                  "source": "column",
                                  "value": "machine_name"
                                },
                                {
                                  "name": "serverName",
                                  "source": "column",
                                  "value": "server_name"
                                },
                                {
                                  "name": "timeRange",
                                  "source": "parameter",
                                  "value": "timeRange"
                                },
                                {
                                  "name": "linkAdxClusterUri",
                                  "source": "parameter",
                                  "value": "adxClusterUri"
                                },
                                {
                                  "name": "linkAdxDatabase",
                                  "source": "parameter",
                                  "value": "adxDatabase"
                                },
                                {
                                  "name": "tabName",
                                  "source": "static",
                                  "value": "Top queries"
                                },
                                {
                                  "name": "showDescriptions",
                                  "source": "parameter",
                                  "value": "showDescriptions"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "count_executions",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "count_successful_executions",
                                  "color": "green"
                                },
                                {
                                  "columnName": "count_aborted_executions",
                                  "color": "orange"
                                },
                                {
                                  "columnName": "count_exception_executions",
                                  "color": "red"
                                }
                              ]
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                          }
                        },
                        {
                          "columnMatch": "count_successful_executions",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "count_aborted_executions",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "count_exception_executions",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "duration_us",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 22,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "cpu_time_us",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 22,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "logical_io_reads",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "logical_io_writes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "physical_io_reads",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "num_physical_io_reads",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "dop",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "query_max_used_memory_kb",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 3,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "rowcount",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "log_bytes_used",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 3,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "tempdb_space_used_kb",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 3,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "global_query_id",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_compositeBar_count_executions_6",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "machine_name",
                          "label": "Machine"
                        },
                        {
                          "columnId": "server_name",
                          "label": "Server"
                        },
                        {
                          "columnId": "database_name",
                          "label": "Database"
                        },
                        {
                          "columnId": "query_id",
                          "label": "Query ID"
                        },
                        {
                          "columnId": "query_plan_hash_agg",
                          "label": "Plan hash"
                        },
                        {
                          "columnId": "plan_id_agg",
                          "label": "Plan ID"
                        },
                        {
                          "columnId": "count_executions",
                          "label": "Executions"
                        },
                        {
                          "columnId": "duration_us",
                          "label": "Duration"
                        },
                        {
                          "columnId": "cpu_time_us",
                          "label": "CPU time"
                        },
                        {
                          "columnId": "logical_io_reads",
                          "label": "Logical reads"
                        },
                        {
                          "columnId": "logical_io_writes",
                          "label": "Logical writes"
                        },
                        {
                          "columnId": "physical_io_reads",
                          "label": "Physical reads (pages)"
                        },
                        {
                          "columnId": "num_physical_io_reads",
                          "label": "Physical reads (IOs)"
                        },
                        {
                          "columnId": "dop",
                          "label": "DOP"
                        },
                        {
                          "columnId": "query_max_used_memory_kb",
                          "label": "Memory grant"
                        },
                        {
                          "columnId": "rowcount",
                          "label": "Rows"
                        },
                        {
                          "columnId": "log_bytes_used",
                          "label": "Log space"
                        },
                        {
                          "columnId": "tempdb_space_used_kb",
                          "label": "Tempdb space"
                        },
                        {
                          "columnId": "sql_module_name_agg",
                          "label": "SQL module"
                        },
                        {
                          "columnId": "context_settings_id_agg",
                          "label": "Context settings ID"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_compositeBar_count_executions_6",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "query_details"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibilities": [
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "database_id",
                "comparison": "isNotEqualTo",
                "value": "0"
              }
            ],
            "name": "per_database_details_group"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "5e875829-c0a1-4d00-b853-d90b119a5883",
                  "version": "KqlParameterItem/1.0",
                  "name": "showPlansAs",
                  "label": "Show query plans as",
                  "type": 10,
                  "description": "Select \"Chart\" to show query plans as bars on a time chart. Select \"Grid\" to show a summary of query plan statistics in a grid.",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\":\"chart\",\"label\":\"Chart\"},\r\n    {\"value\":\"grid\",\"label\":\"Grid\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "chart"
                },
                {
                  "id": "e13aabd4-e4d7-46a7-a1d7-20292f9a521b",
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedGridPlan",
                  "type": 1,
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "{\"plan_id\":0,\"interval_end_time\":\"1900-01-01\"}"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedChartPlan",
                  "type": 1,
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "{\"x\":\"1900-01-01\",\"series\":\"\"}",
                  "id": "8dafcf7a-df0e-4d9b-83ec-55579bad8df5"
                },
                {
                  "id": "b66d1dc9-af20-41b2-8a68-ad2aab7d2ee6",
                  "version": "KqlParameterItem/1.0",
                  "name": "planTabName",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "value": "details"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "query_plan_parameters"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| summarize dcount_databases = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name)),\\r\\n            any_database_name = take_any(database_name),\\r\\n            dcount_plan_id = dcount(strcat(machine_name, \\\"|\\\", server_name, \\\"|\\\", database_name, \\\"|\\\", plan_id)),\\r\\n            any_plan_id = take_any(plan_id),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", round(avg(count_executions), 2),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            interval_end_time = max(interval_end_time)\\r\\n            by query_plan_hash,\\r\\n               plan_id = iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", plan_id, long(null)),\\r\\n               execution_type_desc,\\r\\n               is_forced_plan,\\r\\n               plan_forcing_type_desc\\r\\n| extend plan_id = iif(isnull(plan_id), any_plan_id, plan_id)\\r\\n| project query_plan_hash,\\r\\n          database_name_agg = iif(dcount_databases == 1, any_database_name, strcat(any_database_name, \\\" (+\\\", tostring(dcount_databases - 1), \\\")\\\")),\\r\\n          plan_id,\\r\\n          interval_end_time,\\r\\n          execution_type_desc,\\r\\n          count_executions,\\r\\n          plan_forcing = case(plan_forcing_type_desc == \\\"AUTO\\\", \\\"Auto\\\", plan_forcing_type_desc == \\\"MANUAL\\\" or is_forced_plan, \\\"Manual\\\", \\\"None\\\"),\\r\\n          duration_us,\\r\\n          cpu_time_us,\\r\\n          logical_io_reads,\\r\\n          logical_io_writes,\\r\\n          physical_io_reads,\\r\\n          num_physical_io_reads,\\r\\n          dop,\\r\\n          query_max_used_memory_kb = query_max_used_memory * 8,\\r\\n          rowcount,\\r\\n          log_bytes_used,\\r\\n          tempdb_space_used_kb = tempdb_space_used * 8\\r\\n| sort by case(\\r\\n              \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n              \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n              \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n              \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory_kb),\\r\\n              \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n              \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n              \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used_kb),\\r\\n              real(null)\\r\\n              ) desc,\\r\\n          count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n| take 100 // assumption: looking at more than 100 plans is not interesting\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 1,
              "showAnalytics": true,
              "title": "{qdsAggregation:label} metrics by query plan",
              "noDataMessage": "There is no data for specified parameters.",
              "exportFieldName": "",
              "exportParameterName": "selectedGridPlan",
              "exportDefaultValue": "{\"plan_id\":0,\"interval_end_time\":\"\"}",
              "showExportToExcel": true,
              "queryType": 9,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "plan_id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "interval_end_time",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "execution_type_desc",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Aborted",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Exception",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "18ch"
                    }
                  },
                  {
                    "columnMatch": "count_executions",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                    }
                  },
                  {
                    "columnMatch": "plan_forcing",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Auto",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Manual",
                          "representation": "magenta",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "duration_us",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 22,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "cpu_time_us",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 22,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "logical_io_reads",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "logical_io_writes",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "physical_io_reads",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "24ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "num_physical_io_reads",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "dop",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "query_max_used_memory_kb",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 3,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "rowcount",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "log_bytes_used",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "tempdb_space_used_kb",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    },
                    "numberFormat": {
                      "unit": 3,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "query_plan_hash",
                    "label": "Plan hash"
                  },
                  {
                    "columnId": "database_name_agg",
                    "label": "Database"
                  },
                  {
                    "columnId": "execution_type_desc",
                    "label": "Execution type"
                  },
                  {
                    "columnId": "count_executions",
                    "label": "Executions"
                  },
                  {
                    "columnId": "plan_forcing",
                    "label": "Forcing"
                  },
                  {
                    "columnId": "duration_us",
                    "label": "Duration"
                  },
                  {
                    "columnId": "cpu_time_us",
                    "label": "CPU time"
                  },
                  {
                    "columnId": "logical_io_reads",
                    "label": "Logical reads"
                  },
                  {
                    "columnId": "logical_io_writes",
                    "label": "Logical writes"
                  },
                  {
                    "columnId": "physical_io_reads",
                    "label": "Physical reads (pages)"
                  },
                  {
                    "columnId": "num_physical_io_reads",
                    "label": "Physical reads (IOs)"
                  },
                  {
                    "columnId": "dop",
                    "label": "DOP"
                  },
                  {
                    "columnId": "query_max_used_memory_kb",
                    "label": "Memory grant"
                  },
                  {
                    "columnId": "rowcount",
                    "label": "Rows"
                  },
                  {
                    "columnId": "log_bytes_used",
                    "label": "Log space"
                  },
                  {
                    "columnId": "tempdb_space_used_kb",
                    "label": "Tempdb space"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showPlansAs",
                "comparison": "isEqualTo",
                "value": "grid"
              },
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "showQueriesAs",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_query_plans_grid"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| summarize count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", round(avg(count_executions), 2),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           )\\r\\n            by query_plan_hash,\\r\\n               plan_id = iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", plan_id, long(null)),\\r\\n               interval_end_time\\r\\n| extend metric = case(\\r\\n                      \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n                      real(null)\\r\\n                      )\\r\\n| project plan_label = iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", strcat(\\\"Plan ID: \\\", tostring(plan_id)), strcat(\\\"Plan hash: \\\", query_plan_hash)),\\r\\n          interval_end_time,\\r\\n          metric\\r\\n| make-series metric = avg(metric) default = long(null) on interval_end_time from todatetime(\\\"{qdsStartTime}\\\") to todatetime(\\\"{qdsEndTime}\\\") step {timeRange:grain} by plan_label;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 0,
              "showAnnotations": true,
              "showAnalytics": true,
              "title": "{qdsAggregation:label} {qdsMetricLabelMidsentenceCase} by query plan",
              "noDataMessage": "There is no data for specified parameters.",
              "exportParameterName": "selectedChartPlan",
              "exportDefaultValue": "0",
              "queryType": 9,
              "visualization": "unstackedbar",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_executions",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "count_successful_executions",
                            "color": "green"
                          },
                          {
                            "columnName": "count_aborted_executions",
                            "color": "orange"
                          },
                          {
                            "columnName": "count_exception_executions",
                            "color": "red"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                    }
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "leftContent": {
                  "columnMatch": "rank",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "rightContent": {
                  "columnMatch": "ranked_metric",
                  "formatter": 4,
                  "formatOptions": {
                    "palette": "coldHot"
                  },
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "rank",
                "sortOrderField": 1,
                "size": "auto"
              },
              "chartSettings": {
                "yAxis": [
                  "metric"
                ],
                "group": "plan_label",
                "createOtherGroup": null,
                "showLegend": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showPlansAs",
                "comparison": "isEqualTo",
                "value": "chart"
              },
              {
                "parameterName": "qdsMetricUnit",
                "comparison": "isEqualTo",
                "value": "unitless"
              },
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_query_plan_chart_unitless"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| summarize duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              )\\r\\n            by query_plan_hash,\\r\\n               plan_id = iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", plan_id, long(null)),\\r\\n               interval_end_time\\r\\n| extend metric = case(\\r\\n                      \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n                      real(null)\\r\\n                      )\\r\\n| project plan_label = iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", strcat(\\\"Plan ID: \\\", tostring(plan_id)), strcat(\\\"Plan hash: \\\", query_plan_hash)),\\r\\n          interval_end_time,\\r\\n          metric\\r\\n| make-series metric = avg(metric) default = long(null) on interval_end_time from todatetime(\\\"{qdsStartTime}\\\") to todatetime(\\\"{qdsEndTime}\\\") step {timeRange:grain} by plan_label;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 0,
              "showAnnotations": true,
              "showAnalytics": true,
              "title": "{qdsAggregation:label} {qdsMetricLabelMidsentenceCase} by query plan",
              "noDataMessage": "There is no data for specified parameters.",
              "exportParameterName": "selectedChartPlan",
              "exportDefaultValue": "0",
              "queryType": 9,
              "visualization": "unstackedbar",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_executions",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "count_successful_executions",
                            "color": "green"
                          },
                          {
                            "columnName": "count_aborted_executions",
                            "color": "orange"
                          },
                          {
                            "columnName": "count_exception_executions",
                            "color": "red"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                    }
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "leftContent": {
                  "columnMatch": "rank",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "rightContent": {
                  "columnMatch": "ranked_metric",
                  "formatter": 4,
                  "formatOptions": {
                    "palette": "coldHot"
                  },
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "rank",
                "sortOrderField": 1,
                "size": "auto"
              },
              "chartSettings": {
                "yAxis": [
                  "metric"
                ],
                "group": "plan_label",
                "createOtherGroup": null,
                "showLegend": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 22,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showPlansAs",
                "comparison": "isEqualTo",
                "value": "chart"
              },
              {
                "parameterName": "qdsMetricUnit",
                "comparison": "isEqualTo",
                "value": "time"
              },
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_query_plan_chart_time"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| summarize query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n            by query_plan_hash,\\r\\n               plan_id = iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", plan_id, long(null)),\\r\\n               interval_end_time\\r\\n| extend metric = case(\\r\\n                      \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory * 8 * 1024),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used * 8 * 1024),\\r\\n                      real(null)\\r\\n                      )\\r\\n| project plan_label = iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", strcat(\\\"Plan ID: \\\", tostring(plan_id)), strcat(\\\"Plan hash: \\\", query_plan_hash)),\\r\\n          interval_end_time,\\r\\n          metric\\r\\n| make-series metric = avg(metric) default = long(null) on interval_end_time from todatetime(\\\"{qdsStartTime}\\\") to todatetime(\\\"{qdsEndTime}\\\") step {timeRange:grain} by plan_label;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 0,
              "showAnnotations": true,
              "showAnalytics": true,
              "title": "{qdsAggregation:label} {qdsMetricLabelMidsentenceCase} by query plan",
              "noDataMessage": "There is no data for specified parameters.",
              "exportParameterName": "selectedChartPlan",
              "exportDefaultValue": "0",
              "queryType": 9,
              "visualization": "unstackedbar",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_executions",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "count_successful_executions",
                            "color": "green"
                          },
                          {
                            "columnName": "count_aborted_executions",
                            "color": "orange"
                          },
                          {
                            "columnName": "count_exception_executions",
                            "color": "red"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
                    }
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "leftContent": {
                  "columnMatch": "rank",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "tooltipFormat": {
                    "tooltip": "Query rank"
                  }
                },
                "rightContent": {
                  "columnMatch": "ranked_metric",
                  "formatter": 4,
                  "formatOptions": {
                    "palette": "coldHot"
                  },
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "rank",
                "sortOrderField": 1,
                "size": "auto"
              },
              "chartSettings": {
                "yAxis": [
                  "metric"
                ],
                "group": "plan_label",
                "createOtherGroup": null,
                "showLegend": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 2,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showPlansAs",
                "comparison": "isEqualTo",
                "value": "chart"
              },
              {
                "parameterName": "qdsMetricUnit",
                "comparison": "isEqualTo",
                "value": "bytes"
              },
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "qdsStartTime",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsEndTime",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "qds_query_plan_chart_bytes"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "5537e73a-2aa9-4f11-9f3b-a1894f13be60",
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedChartPlanId",
                  "type": 1,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", tolong(replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan ID: \\\", \\\"\\\")), plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan hash: \\\", \\\"\\\"), query_plan_hash)\\r\\n| top 1 by collection_time_utc desc\\r\\n| project plan_id\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 9
                },
                {
                  "id": "b551bad3-2098-47d2-ab67-852c93ea574b",
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedChartPlanHash",
                  "type": 1,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_plan_hash == replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan hash: \\\", \\\"\\\")\\r\\n| top 1 by collection_time_utc desc\\r\\n| project query_plan_hash\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 9
                },
                {
                  "id": "3bbed235-3813-4be5-bfe3-0766b4383fe5",
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedChartIntervalEndTime",
                  "type": 1,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"// Time (x-coordinate) selected on a chart is generated by make-series and is unlikely to match any existing interval_end_time.\\r\\n// Look up the nearest interval_end_time here.\\r\\nunion\\r\\n(\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{selectedChartPlan:$.x}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", tolong(replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan ID: \\\", \\\"\\\")), plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan hash: \\\", \\\"\\\"), query_plan_hash)\\r\\n| summarize interval_end_time = max(interval_end_time)\\r\\n),\\r\\n(\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{selectedChartPlan:$.x}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", tolong(replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan ID: \\\", \\\"\\\")), plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan hash: \\\", \\\"\\\"), query_plan_hash)\\r\\n| summarize interval_end_time = min(interval_end_time)\\r\\n)\\r\\n| summarize interval_end_time = min(interval_end_time)\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 9
                },
                {
                  "id": "046d7500-d82b-43d9-b857-62e350285137",
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedGridPlanId",
                  "type": 1,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"print plan_id = tolong(\\\"{selectedGridPlan:$.plan_id}\\\")\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 9
                },
                {
                  "id": "1d92a89b-f1b1-4642-b09c-fd015f67cf9c",
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedGridPlanHash",
                  "type": 1,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"print plan_hash = \\\"{selectedGridPlan:$.query_plan_hash}\\\"\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 9
                },
                {
                  "id": "aa9ce676-6214-44be-8a4a-af84f775c14e",
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedGridIntervalEndTime",
                  "type": 1,
                  "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"print interval_end_time = \\\"{selectedGridPlan:$.interval_end_time}\\\"\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 9
                },
                {
                  "id": "e669c402-166b-4e3e-bd6c-2fc79441467a",
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedPlanId",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "showPlansAs",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "grid",
                        "resultValType": "param",
                        "resultVal": "selectedGridPlanId"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "showPlansAs",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "chart",
                        "resultValType": "param",
                        "resultVal": "selectedChartPlanId"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "0"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedPlanHash",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "showPlansAs",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "grid",
                        "resultValType": "param",
                        "resultVal": "selectedGridPlanHash"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "showPlansAs",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "chart",
                        "resultValType": "param",
                        "resultVal": "selectedChartPlanHash"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "0"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "120eaca9-83d5-447d-af06-098e53d04674"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "selectedIntervalEndTime",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "showPlansAs",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "grid",
                        "resultValType": "param",
                        "resultVal": "selectedGridIntervalEndTime"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "showPlansAs",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "chart",
                        "resultValType": "param",
                        "resultVal": "selectedChartIntervalEndTime"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "\"1900-01-01\""
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "903fef93-1c44-4bd7-867e-14b50d01f80e"
                }
              ],
              "style": "pills",
              "queryType": 9
            },
            "name": "selected_plan_parameters"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "96c6627e-1c4f-49cb-86e8-928964ecfc19",
                  "cellValue": "planTabName",
                  "linkTarget": "parameter",
                  "linkLabel": "Plan details",
                  "subTarget": "details",
                  "style": "link"
                },
                {
                  "id": "e8e0a56b-d1d9-46d0-ab32-e5864d25574f",
                  "cellValue": "planTabName",
                  "linkTarget": "parameter",
                  "linkLabel": "Plan XML",
                  "subTarget": "xmlPlan",
                  "style": "link"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "selectedIntervalEndTime",
                "comparison": "isNotEqualTo",
                "value": "null"
              },
              {
                "parameterName": "selectedPlanId",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "plan_detail_tabs"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"engine_version\\\",\\r\\n1, \\\"query_plan_hash\\\",\\r\\n1, \\\"last_force_failure_reason_desc\\\",\\r\\n1, \\\"plan_forcing_type_desc\\\",\\r\\n1, \\\"database_name\\\"\\r\\n];\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, engine_version, query_plan_hash, last_force_failure_reason_desc, plan_forcing_type_desc, database_name)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, engine_version, query_plan_hash, last_force_failure_reason_desc, plan_forcing_type_desc, database_name\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"engine_version\\\", engine_version,\\r\\n                                    plan_property_name == \\\"query_plan_hash\\\", query_plan_hash,\\r\\n                                    plan_property_name == \\\"last_force_failure_reason_desc\\\", last_force_failure_reason_desc,\\r\\n                                    plan_property_name == \\\"plan_forcing_type_desc\\\", plan_forcing_type_desc,\\r\\n                                    plan_property_name == \\\"database_name\\\", database_name,\\r\\n                                    \\\"\\\"\\r\\n                                    )\\r\\n| project-away engine_version, query_plan_hash, last_force_failure_reason_desc, plan_forcing_type_desc, database_name\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                    "size": 3,
                    "showAnalytics": true,
                    "noDataMessage": "There is no data for specified parameters.",
                    "showExportToExcel": true,
                    "queryType": 9,
                    "gridSettings": {
                      "labelSettings": [
                        {
                          "columnId": "plan_property_name",
                          "label": "Property"
                        },
                        {
                          "columnId": "plan_property_value",
                          "label": "Value"
                        }
                      ]
                    }
                  },
                  "customWidth": "33",
                  "name": "plan_details_string"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"is_parallel_plan\\\",\\r\\n1, \\\"is_forced_plan\\\",\\r\\n1, \\\"is_natively_compiled\\\",\\r\\n1, \\\"has_compile_replay_script\\\"\\r\\n];\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, is_parallel_plan, is_forced_plan, is_natively_compiled, has_compile_replay_script)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, is_parallel_plan, is_forced_plan, is_natively_compiled, has_compile_replay_script\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"is_parallel_plan\\\", is_parallel_plan,\\r\\n                                    plan_property_name == \\\"is_forced_plan\\\", is_forced_plan,\\r\\n                                    plan_property_name == \\\"is_natively_compiled\\\", is_natively_compiled,\\r\\n                                    plan_property_name == \\\"has_compile_replay_script\\\", has_compile_replay_script,\\r\\n                                    bool(null)\\r\\n                                    )\\r\\n| project-away is_parallel_plan, is_forced_plan, is_natively_compiled, has_compile_replay_script\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                    "size": 3,
                    "showAnalytics": true,
                    "noDataMessage": "There is no data for specified parameters.",
                    "showExportToExcel": true,
                    "queryType": 9,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "plan_property_value",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "Check",
                                "text": ""
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "Subtract",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "plan_property_name",
                          "label": "Property"
                        },
                        {
                          "columnId": "plan_property_value",
                          "label": "Value"
                        }
                      ]
                    }
                  },
                  "customWidth": "33",
                  "name": "plan_details_boolean"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"plan_id\\\",\\r\\n1, \\\"plan_group_id\\\",\\r\\n1, \\\"force_failure_count\\\",\\r\\n1, \\\"plan_count_compiles\\\",\\r\\n1, \\\"compatibility_level\\\",\\r\\n1, \\\"database_id\\\"\\r\\n];\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, plan_id, plan_group_id, force_failure_count, plan_count_compiles, compatibility_level, database_id)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, plan_id, plan_group_id, force_failure_count, plan_count_compiles, compatibility_level, database_id\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"plan_id\\\", plan_id,\\r\\n                                    plan_property_name == \\\"plan_group_id\\\", plan_group_id,\\r\\n                                    plan_property_name == \\\"force_failure_count\\\", force_failure_count,\\r\\n                                    plan_property_name == \\\"plan_count_compiles\\\", plan_count_compiles,\\r\\n                                    plan_property_name == \\\"compatibility_level\\\", tolong(compatibility_level),\\r\\n                                    plan_property_name == \\\"database_id\\\", tolong(database_id),\\r\\n                                    long(null)\\r\\n                                    )\\r\\n| project-away plan_id, plan_group_id, force_failure_count, plan_count_compiles, compatibility_level, database_id\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                    "size": 3,
                    "showAnalytics": true,
                    "noDataMessage": "There is no data for specified parameters.",
                    "showExportToExcel": true,
                    "queryType": 9,
                    "gridSettings": {
                      "labelSettings": [
                        {
                          "columnId": "plan_property_name",
                          "label": "Property"
                        },
                        {
                          "columnId": "plan_property_value",
                          "label": "Value"
                        }
                      ]
                    }
                  },
                  "customWidth": "33",
                  "name": "plan_details_number"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"plan_initial_compile_start_time\\\",\\r\\n1, \\\"plan_last_compile_start_time\\\",\\r\\n1, \\\"plan_last_execution_time\\\"\\r\\n];\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, plan_initial_compile_start_time, plan_last_compile_start_time, plan_last_execution_time)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, plan_initial_compile_start_time, plan_last_compile_start_time, plan_last_execution_time\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"plan_initial_compile_start_time\\\", plan_initial_compile_start_time,\\r\\n                                    plan_property_name == \\\"plan_last_compile_start_time\\\", plan_last_compile_start_time,\\r\\n                                    plan_property_name == \\\"plan_last_execution_time\\\", plan_last_execution_time,\\r\\n                                    datetime(null)\\r\\n                                    )\\r\\n| project-away plan_initial_compile_start_time, plan_last_compile_start_time, plan_last_execution_time\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                    "size": 3,
                    "showAnalytics": true,
                    "noDataMessage": "There is no data for specified parameters.",
                    "showExportToExcel": true,
                    "queryType": 9,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "plan_property_value",
                          "formatter": 6,
                          "dateFormat": {
                            "showUtcTime": null,
                            "formatName": "shortDateTimePattern"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "plan_property_name",
                          "label": "Property"
                        },
                        {
                          "columnId": "plan_property_value",
                          "label": "Value"
                        }
                      ]
                    }
                  },
                  "customWidth": "33",
                  "name": "plan_details_datetime"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"plan_avg_compile_duration\\\",\\r\\n1, \\\"plan_last_compile_duration\\\"\\r\\n];\\r\\nsqlserver_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, plan_avg_compile_duration_us, plan_last_compile_duration_us)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, plan_avg_compile_duration_us, plan_last_compile_duration_us\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"plan_avg_compile_duration\\\", plan_avg_compile_duration_us,\\r\\n                                    plan_property_name == \\\"plan_last_compile_duration\\\", toreal(plan_last_compile_duration_us),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n| project-away plan_avg_compile_duration_us, plan_last_compile_duration_us\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
                    "size": 3,
                    "showAnalytics": true,
                    "noDataMessage": "There is no data for specified parameters.",
                    "showExportToExcel": true,
                    "queryType": 9,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "plan_property_value",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 22,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "plan_property_name",
                          "label": "Property"
                        },
                        {
                          "columnId": "plan_property_value",
                          "label": "Value"
                        }
                      ]
                    }
                  },
                  "customWidth": "33",
                  "name": "plan_details_duration"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "planTabName",
                "comparison": "isEqualTo",
                "value": "details"
              },
              {
                "parameterName": "selectedPlanId",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "plan_details_group"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqlserver_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n{machineNameFilter}\\r\\n{serverNameFilter}\\r\\n{qdsDatabaseNameFilter}\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n// always filter by query hash; additionally, if a query_id in a specific database is selected, restrict to plans for that query\\r\\n| where query_hash == \\\"{query_hash}\\\"\\r\\n| where machine_name == iif(\\\"{global_query_id:$.machine_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.machine_name}\\\", machine_name)\\r\\n| where server_name == iif(\\\"{global_query_id:$.server_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.server_name}\\\", server_name)\\r\\n| where database_name == iif(\\\"{global_query_id:$.database_name}\\\" != \\\"null\\\", \\\"{global_query_id:$.database_name}\\\", database_name)\\r\\n| where query_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {global_query_id:$.query_id}, query_id)\\r\\n| where plan_id == iif(\\\"{global_query_id:$.query_id}\\\" != \\\"0\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{global_query_id:$.query_id}\\\" == \\\"0\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, query_plan)\\r\\n| project query_plan\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "noDataMessage": "Unknown",
              "queryType": 9,
              "visualization": "card",
              "textSettings": {
                "style": "editor"
              }
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "query_hash",
                "comparison": "isNotEqualTo",
                "value": "\"\""
              },
              {
                "parameterName": "qdsMetric",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsAggregation",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "qdsTopQueryCount",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "selectedIntervalEndTime",
                "comparison": "isNotEqualTo",
                "value": "null"
              },
              {
                "parameterName": "planTabName",
                "comparison": "isEqualTo",
                "value": "xmlPlan"
              },
              {
                "parameterName": "selectedPlanId",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "query_xml_plan"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tabName",
          "comparison": "isEqualTo",
          "value": "Top queries"
        },
        {
          "parameterName": "sqlserver_query_runtime_stats",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "matchPattern",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "top_queries_group"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}